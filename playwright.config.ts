/**
 * Playwrightè¨­å®šãƒ•ã‚¡ã‚¤ãƒ«
 *
 * é–¢é€£æ–‡æ›¸:
 * - ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£è¨­è¨ˆ: docs/design/frontend-test-infra/architecture.md
 * - ãƒ†ã‚¹ãƒˆãƒ‘ã‚¿ãƒ¼ãƒ³: docs/design/frontend-test-infra/test-patterns.md
 *
 * ä¿¡é ¼æ€§: ğŸ”µ Playwrightå…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã€Astroãƒ†ã‚¹ãƒˆãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹ã«åŸºã¥ã
 */

import { defineConfig, devices } from '@playwright/test';

/**
 * Playwrightè¨­å®š
 * https://playwright.dev/docs/test-configuration
 */
export default defineConfig({
  // ========================================
  // ãƒ†ã‚¹ãƒˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªè¨­å®š
  // ========================================

  /**
   * E2Eãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã®å ´æ‰€
   */
  testDir: './tests/e2e',

  /**
   * ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒ‘ã‚¿ãƒ¼ãƒ³
   */
  testMatch: '**/*.spec.ts',

  // ========================================
  // ä¸¦åˆ—å®Ÿè¡Œè¨­å®š
  // ========================================

  /**
   * å®Œå…¨ä¸¦åˆ—å®Ÿè¡Œ
   * - true: ã™ã¹ã¦ã®ãƒ†ã‚¹ãƒˆã‚’ä¸¦åˆ—å®Ÿè¡Œï¼ˆé«˜é€Ÿï¼‰
   * - false: ãƒ•ã‚¡ã‚¤ãƒ«å˜ä½ã§ä¸¦åˆ—ã€ãƒ•ã‚¡ã‚¤ãƒ«å†…ã¯ç›´åˆ—
   */
  fullyParallel: true,

  /**
   * ãƒ¯ãƒ¼ã‚«ãƒ¼æ•°
   * - CIç’°å¢ƒã§ã¯1ï¼ˆå®‰å®šæ€§å„ªå…ˆï¼‰
   * - ãƒ­ãƒ¼ã‚«ãƒ«ã§ã¯ä¸¦åˆ—å®Ÿè¡Œï¼ˆé«˜é€Ÿï¼‰
   */
  workers: process.env.CI ? 1 : undefined,

  // ========================================
  // ãƒªãƒˆãƒ©ã‚¤è¨­å®š
  // ========================================

  /**
   * å¤±æ•—æ™‚ã®ãƒªãƒˆãƒ©ã‚¤å›æ•°
   * - CIç’°å¢ƒã§ã¯2å›ï¼ˆãƒ•ãƒ¬ã‚¤ã‚­ãƒ¼ãƒ†ã‚¹ãƒˆå¯¾ç­–ï¼‰
   * - ãƒ­ãƒ¼ã‚«ãƒ«ã§ã¯0å›
   */
  retries: process.env.CI ? 2 : 0,

  // ========================================
  // ãƒ¬ãƒãƒ¼ãƒˆè¨­å®š
  // ========================================

  /**
   * ãƒ¬ãƒãƒ¼ã‚¿ãƒ¼
   * - list: ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ã«ãƒªã‚¹ãƒˆè¡¨ç¤º
   * - html: HTMLãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆ
   * - json: JSONå½¢å¼ï¼ˆCI/CDç”¨ï¼‰
   * - junit: JUnit XMLå½¢å¼ï¼ˆCI/CDç”¨ï¼‰
   */
  reporter: [
    ['list'],
    ['html', { outputFolder: 'playwright-report' }],
    ['json', { outputFile: 'test-results/results.json' }],
    ['junit', { outputFile: 'test-results/junit.xml' }],
  ],

  // ========================================
  // ã‚°ãƒ­ãƒ¼ãƒãƒ«è¨­å®š
  // ========================================

  use: {
    /**
     * ãƒ™ãƒ¼ã‚¹URL
     * ãƒ“ãƒ«ãƒ‰æ¸ˆã¿é™çš„ã‚µã‚¤ãƒˆã‚’ãƒ­ãƒ¼ã‚«ãƒ«ã‚µãƒ¼ãƒãƒ¼ã§èµ·å‹•
     */
    baseURL: 'http://localhost:4321',

    /**
     * ãƒˆãƒ¬ãƒ¼ã‚¹è¨­å®š
     * - on-first-retry: æœ€åˆã®ãƒªãƒˆãƒ©ã‚¤æ™‚ã®ã¿ãƒˆãƒ¬ãƒ¼ã‚¹ä¿å­˜ï¼ˆæ¨å¥¨ï¼‰
     * - on: å¸¸ã«ãƒˆãƒ¬ãƒ¼ã‚¹ä¿å­˜ï¼ˆãƒ‡ãƒãƒƒã‚°æ™‚ï¼‰
     * - off: ãƒˆãƒ¬ãƒ¼ã‚¹ç„¡åŠ¹
     */
    trace: 'on-first-retry',

    /**
     * ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆè¨­å®š
     * - only-on-failure: å¤±æ•—æ™‚ã®ã¿ï¼ˆæ¨å¥¨ï¼‰
     * - on: å¸¸ã«ä¿å­˜
     * - off: ç„¡åŠ¹
     */
    screenshot: 'only-on-failure',

    /**
     * ãƒ“ãƒ‡ã‚ªè¨­å®š
     * - retain-on-failure: å¤±æ•—æ™‚ã®ã¿ä¿å­˜ï¼ˆæ¨å¥¨ï¼‰
     * - on: å¸¸ã«ä¿å­˜
     * - off: ç„¡åŠ¹
     */
    video: 'retain-on-failure',

    /**
     * ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆ
     * ã‚¯ãƒªãƒƒã‚¯ã€å…¥åŠ›ç­‰ã®ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã®ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆï¼ˆãƒŸãƒªç§’ï¼‰
     */
    actionTimeout: 10000,

    /**
     * ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆ
     * ãƒšãƒ¼ã‚¸é·ç§»ã®ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆï¼ˆãƒŸãƒªç§’ï¼‰
     */
    navigationTimeout: 30000,
  },

  // ========================================
  // ãƒ–ãƒ©ã‚¦ã‚¶ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆè¨­å®š
  // ========================================

  projects: [
    /**
     * Chromiumï¼ˆChrome, Edgeï¼‰
     * ãƒ¡ã‚¤ãƒ³ãƒ–ãƒ©ã‚¦ã‚¶ã¨ã—ã¦ä½¿ç”¨
     */
    {
      name: 'chromium',
      use: { ...devices['Desktop Chrome'] },
    },

    /**
     * Firefox
     * ã‚¯ãƒ­ã‚¹ãƒ–ãƒ©ã‚¦ã‚¶ãƒ†ã‚¹ãƒˆç”¨
     */
    {
      name: 'firefox',
      use: { ...devices['Desktop Firefox'] },
    },

    /**
     * WebKitï¼ˆSafariï¼‰
     * ã‚¯ãƒ­ã‚¹ãƒ–ãƒ©ã‚¦ã‚¶ãƒ†ã‚¹ãƒˆç”¨
     */
    {
      name: 'webkit',
      use: { ...devices['Desktop Safari'] },
    },

    /**
     * ãƒ¢ãƒã‚¤ãƒ«ãƒ–ãƒ©ã‚¦ã‚¶
     * ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–ãƒ‡ã‚¶ã‚¤ãƒ³ãƒ†ã‚¹ãƒˆç”¨
     */

    // iPhone SE
    {
      name: 'Mobile Chrome',
      use: { ...devices['iPhone SE'] },
    },

    // iPhone 14 Pro
    {
      name: 'Mobile Safari',
      use: { ...devices['iPhone 14 Pro'] },
    },

    // iPad Pro
    {
      name: 'Tablet Safari',
      use: { ...devices['iPad Pro'] },
    },
  ],

  // ========================================
  // Webã‚µãƒ¼ãƒãƒ¼è¨­å®š
  // ========================================

  /**
   * ãƒ†ã‚¹ãƒˆå®Ÿè¡Œå‰ã«Webã‚µãƒ¼ãƒãƒ¼ã‚’èµ·å‹•
   * Astroã®ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚µãƒ¼ãƒãƒ¼ã‚’ä½¿ç”¨
   */
  webServer: {
    /**
     * ã‚µãƒ¼ãƒãƒ¼èµ·å‹•ã‚³ãƒãƒ³ãƒ‰
     * 1. pnpm build: é™çš„ã‚µã‚¤ãƒˆã‚’ãƒ“ãƒ«ãƒ‰
     * 2. pnpm preview: ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚µãƒ¼ãƒãƒ¼èµ·å‹•
     */
    command: 'pnpm build && pnpm preview',

    /**
     * ã‚µãƒ¼ãƒãƒ¼URL
     * Astroã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ãƒãƒ¼ãƒˆ
     */
    url: 'http://localhost:4321',

    /**
     * ã‚µãƒ¼ãƒãƒ¼èµ·å‹•ã‚’å¾…ã¤
     * - true: ã‚µãƒ¼ãƒãƒ¼èµ·å‹•å®Œäº†ã¾ã§ãƒ†ã‚¹ãƒˆã‚’å¾…æ©Ÿ
     */
    reuseExistingServer: !process.env.CI,

    /**
     * ã‚µãƒ¼ãƒãƒ¼èµ·å‹•ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆï¼ˆãƒŸãƒªç§’ï¼‰
     */
    timeout: 120000,

    /**
     * æ¨™æº–å‡ºåŠ›ã‚’ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ã«è¡¨ç¤º
     */
    stdout: 'pipe',
    stderr: 'pipe',
  },

  // ========================================
  // ãƒ†ã‚¹ãƒˆã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆè¨­å®š
  // ========================================

  /**
   * å„ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ã®ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆï¼ˆãƒŸãƒªç§’ï¼‰
   */
  timeout: 30000,

  /**
   * expect()ã®ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆï¼ˆãƒŸãƒªç§’ï¼‰
   */
  expect: {
    timeout: 5000,
  },

  // ========================================
  // å‡ºåŠ›ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªè¨­å®š
  // ========================================

  /**
   * ãƒ†ã‚¹ãƒˆçµæœå‡ºåŠ›å…ˆ
   */
  outputDir: 'test-results',

  // ========================================
  // ã‚°ãƒ­ãƒ¼ãƒãƒ«ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ãƒ»ãƒ†ã‚£ã‚¢ãƒ€ã‚¦ãƒ³
  // ========================================

  /**
   * ã‚°ãƒ­ãƒ¼ãƒãƒ«ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—
   * ã™ã¹ã¦ã®ãƒ†ã‚¹ãƒˆå®Ÿè¡Œå‰ã«1åº¦ã ã‘å®Ÿè¡Œ
   */
  // globalSetup: './tests/e2e/global-setup.ts',

  /**
   * ã‚°ãƒ­ãƒ¼ãƒãƒ«ãƒ†ã‚£ã‚¢ãƒ€ã‚¦ãƒ³
   * ã™ã¹ã¦ã®ãƒ†ã‚¹ãƒˆå®Ÿè¡Œå¾Œã«1åº¦ã ã‘å®Ÿè¡Œ
   */
  // globalTeardown: './tests/e2e/global-teardown.ts',
});
