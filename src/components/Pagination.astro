---
/**
 * ãƒšãƒ¼ã‚¸ãƒãƒ¼ã‚·ãƒ§ãƒ³ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
 *
 * è¦ä»¶:
 * - TASK-0012: ãƒšãƒ¼ã‚¸ãƒãƒ¼ã‚·ãƒ§ãƒ³æ©Ÿèƒ½
 * - NFR-301: ã‚»ãƒãƒ³ãƒ†ã‚£ãƒƒã‚¯HTMLï¼ˆnavè¦ç´ ä½¿ç”¨ï¼‰
 * - NFR-302: ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³å¯¾å¿œ
 * - NFR-303: ARIAãƒ©ãƒ™ãƒ«é©åˆ‡ãªè¨­å®š
 *
 * ä¿¡é ¼æ€§: ğŸ”µ ã‚¿ã‚¹ã‚¯å®šç¾©ã‚ˆã‚Š
 */

import type { Page } from 'astro';

interface Props {
  page: Page<unknown>;
}

const { page } = Astro.props;
const { currentPage, lastPage, url } = page;

// è¡¨ç¤ºã™ã‚‹ãƒšãƒ¼ã‚¸ç•ªå·ã‚’è¨ˆç®—ï¼ˆç¾åœ¨ã®ãƒšãƒ¼ã‚¸ã‚’ä¸­å¿ƒã«æœ€å¤§5ãƒšãƒ¼ã‚¸è¡¨ç¤ºï¼‰
function getPageNumbers(current: number, total: number): number[] {
  if (total <= 5) {
    return Array.from({ length: total }, (_, i) => i + 1);
  }

  // ç¾åœ¨ã®ãƒšãƒ¼ã‚¸ã‚’ä¸­å¿ƒã«å‰å¾Œ2ãƒšãƒ¼ã‚¸ã‚’è¡¨ç¤º
  let start = Math.max(1, current - 2);
  let end = Math.min(total, current + 2);

  // ç«¯ã«å¯„ã£ã¦ã„ã‚‹å ´åˆã¯èª¿æ•´
  if (current <= 2) {
    end = 5;
  } else if (current >= total - 1) {
    start = total - 4;
  }

  return Array.from({ length: end - start + 1 }, (_, i) => start + i);
}

const pageNumbers = getPageNumbers(currentPage, lastPage);
---

{lastPage > 1 && (
  <nav
    class="mt-12 flex justify-center"
    aria-label="ãƒšãƒ¼ã‚¸ãƒãƒ¼ã‚·ãƒ§ãƒ³"
    data-testid="pagination"
  >
    <ul class="flex items-center gap-2">
      <!-- æœ€åˆã®ãƒšãƒ¼ã‚¸ -->
      {currentPage > 1 && (
        <li>
          <a
            href={url.first}
            class="px-3 py-2 rounded border border-gray-300 dark:border-gray-600 hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors"
            aria-label="æœ€åˆã®ãƒšãƒ¼ã‚¸ã¸"
            data-testid="pagination-first"
          >
            Â«
          </a>
        </li>
      )}

      <!-- å‰ã®ãƒšãƒ¼ã‚¸ -->
      {url.prev && (
        <li>
          <a
            href={url.prev}
            class="px-3 py-2 rounded border border-gray-300 dark:border-gray-600 hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors"
            aria-label="å‰ã®ãƒšãƒ¼ã‚¸ã¸"
            data-testid="pagination-prev"
          >
            â€¹
          </a>
        </li>
      )}

      <!-- ãƒšãƒ¼ã‚¸ç•ªå· -->
      {pageNumbers.map((num) => (
        <li>
          {num === currentPage ? (
            <span
              class="px-4 py-2 rounded bg-blue-600 text-white font-medium"
              aria-current="page"
              data-testid="pagination-current"
            >
              {num}
            </span>
          ) : (
            <a
              href={`/blog/${num}`}
              class="px-4 py-2 rounded border border-gray-300 dark:border-gray-600 hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors"
              aria-label={`${num}ãƒšãƒ¼ã‚¸ç›®ã¸`}
              data-testid={`pagination-page-${num}`}
            >
              {num}
            </a>
          )}
        </li>
      ))}

      <!-- æ¬¡ã®ãƒšãƒ¼ã‚¸ -->
      {url.next && (
        <li>
          <a
            href={url.next}
            class="px-3 py-2 rounded border border-gray-300 dark:border-gray-600 hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors"
            aria-label="æ¬¡ã®ãƒšãƒ¼ã‚¸ã¸"
            data-testid="pagination-next"
          >
            â€º
          </a>
        </li>
      )}

      <!-- æœ€å¾Œã®ãƒšãƒ¼ã‚¸ -->
      {currentPage < lastPage && (
        <li>
          <a
            href={url.last}
            class="px-3 py-2 rounded border border-gray-300 dark:border-gray-600 hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors"
            aria-label="æœ€å¾Œã®ãƒšãƒ¼ã‚¸ã¸"
            data-testid="pagination-last"
          >
            Â»
          </a>
        </li>
      )}
    </ul>
  </nav>
)}
