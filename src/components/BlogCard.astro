---
/**
 * BlogCard - ブログカードコンポーネント
 *
 * 【機能概要】: ブログ記事のプレビューカードを表示
 * 【実装方針】: セマンティックHTMLとWCAG 2.1 AA準拠のアクセシビリティを実現
 * 【設計方針】: ゼロJavaScript、SSG専用による最高のパフォーマンス
 * 【パフォーマンス】: 遅延読み込み画像、トランジションによる滑らかなホバーエフェクト
 *
 * 関連要件:
 * - TASK-0013: ブログカードコンポーネントの実装
 * - カバー画像（フォールバック対応）
 * - タイトル、説明文、公開日
 * - タグ一覧表示
 * - ホバーエフェクト
 * - レスポンシブ対応
 */

interface Props {
  /**
   * 記事タイトル（必須）
   */
  title: string;

  /**
   * 記事説明文（必須）
   */
  description: string;

  /**
   * 公開日（必須）
   */
  pubDate: Date;

  /**
   * 記事スラッグ（必須）- URLに使用
   */
  slug: string;

  /**
   * カバー画像URL（任意）
   * 未指定の場合はプレースホルダー画像を使用
   */
  coverImage?: string;

  /**
   * タグ一覧（任意）
   */
  tags?: string[];
}

const {
  title,
  description,
  pubDate,
  slug,
  coverImage = 'https://placehold.co/1200x630',
  tags = [],
} = Astro.props;

/**
 * 日付をフォーマット（日本語形式）
 * 例: 2025年1月15日
 */
const formatDate = (date: Date): string => {
  return date.toLocaleDateString('ja-JP', {
    year: 'numeric',
    month: 'long',
    day: 'numeric',
  });
};

/**
 * 日付をISO形式でフォーマット（datetime属性用）
 * 例: 2025-01-15
 */
const formatDateISO = (date: Date): string => {
  return date.toISOString().split('T')[0];
};
---

<!--
  【ブログカードコンテナ】
  articleタグで記事コンテンツを意味的にマークアップ

  【スタイリング】:
  - ライトモード: bg-white（白背景）
  - ダークモード: dark:bg-gray-800（ダークグレー背景）
  - 角丸: rounded-lg
  - シャドウ: shadow-md → hover:shadow-xl（ホバー時に強調）
  - トランジション: transition-all duration-300（滑らかなアニメーション）
  - ホバー時: hover:-translate-y-1（上方向に軽くリフト）
  - オーバーフロー: overflow-hidden（角丸からのはみ出し防止）
-->
<article
  class="bg-white dark:bg-gray-800 rounded-lg shadow-md hover:shadow-xl transition-all duration-300 hover:-translate-y-1 overflow-hidden"
>
  <a
    href={`/blog/${slug}`}
    class="block focus:outline-none focus-visible:ring-2 focus-visible:ring-blue-500 focus-visible:ring-offset-2"
  >
    <!--
      【カバー画像セクション】
      アスペクト比を維持した画像表示

      【パフォーマンス】:
      - loading="lazy": 遅延読み込みでパフォーマンス向上
      - object-cover: 画像のアスペクト比を維持しつつコンテナにフィット

      【レスポンシブ】:
      - w-full: 幅100%
      - aspect-video: 16:9のアスペクト比
    -->
    <div class="relative aspect-video overflow-hidden">
      <img
        src={coverImage}
        alt={`${title}のカバー画像`}
        loading="lazy"
        class="w-full h-full object-cover transition-transform duration-300 hover:scale-105"
      />
    </div>

    <!--
      【コンテンツセクション】
      タイトル、説明文、公開日を表示
    -->
    <div class="p-4 md:p-6">
      <!--
        【公開日】
        time要素でセマンティックにマークアップ
        datetime属性でISO形式の日付を設定
      -->
      <time
        datetime={formatDateISO(pubDate)}
        class="text-sm text-gray-500 dark:text-gray-400"
      >
        {formatDate(pubDate)}
      </time>

      <!--
        【タイトル】
        h3要素で見出し階層を適切に設定（親コンテナのh2の下位）
        ホバー時に色変化
      -->
      <h3
        class="mt-2 text-lg md:text-xl font-bold text-gray-900 dark:text-gray-100 line-clamp-2 hover:text-blue-600 dark:hover:text-blue-400 transition-colors duration-200"
      >
        {title}
      </h3>

      <!--
        【説明文】
        最大3行で省略表示
      -->
      <p class="mt-2 text-gray-600 dark:text-gray-300 text-sm md:text-base line-clamp-3">
        {description}
      </p>
    </div>
  </a>

  <!--
    【タグセクション】
    タグが存在する場合のみ表示
    タグはリンクとして機能し、タグページに遷移可能
  -->
  {
    tags.length > 0 && (
      <div class="px-4 pb-4 md:px-6 md:pb-6">
        <div class="flex flex-wrap gap-2">
          {tags.map((tag) => (
            <a
              href={`/tags/${tag}`}
              class="inline-block px-3 py-1 text-xs md:text-sm font-medium text-blue-600 dark:text-blue-400 bg-blue-50 dark:bg-blue-900/30 rounded-full hover:bg-blue-100 dark:hover:bg-blue-900/50 transition-colors duration-200"
            >
              {tag}
            </a>
          ))}
        </div>
      </div>
    )
  }
</article>
