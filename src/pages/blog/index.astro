---
/**
 * ãƒ–ãƒ­ã‚°è¨˜äº‹ä¸€è¦§ãƒšãƒ¼ã‚¸ï¼ˆ1ãƒšãƒ¼ã‚¸ç›®ï¼‰
 *
 * /blog ã¸ã®ã‚¢ã‚¯ã‚»ã‚¹æ™‚ã«è¡¨ç¤ºã•ã‚Œã‚‹ãƒšãƒ¼ã‚¸
 * /blog/1 ã¨åŒã˜å†…å®¹ã‚’è¡¨ç¤ºï¼ˆã¡ã‚‰ã¤ããªã—ï¼‰
 *
 * è¦ä»¶:
 * - TASK-0012: ãƒšãƒ¼ã‚¸ãƒãƒ¼ã‚·ãƒ§ãƒ³æ©Ÿèƒ½ï¼ˆ5ä»¶/ãƒšãƒ¼ã‚¸ï¼‰
 * - NFR-301: ã‚»ãƒžãƒ³ãƒ†ã‚£ãƒƒã‚¯HTML
 * - NFR-302: ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³å¯¾å¿œ
 *
 * ä¿¡é ¼æ€§: ðŸ”µ ã‚¿ã‚¹ã‚¯å®šç¾©ã‚ˆã‚Š
 */

import { getCollection } from 'astro:content';
import Pagination from '../../components/Pagination.astro';
import BaseLayout from '../../layouts/BaseLayout.astro';

/** 1ãƒšãƒ¼ã‚¸ã‚ãŸã‚Šã®è¨˜äº‹æ•° */
const PAGE_SIZE = 5;

// å…¨ãƒ–ãƒ­ã‚°è¨˜äº‹ã‚’å–å¾—ï¼ˆä¸‹æ›¸ãã‚’é™¤å¤–ã€å…¬é–‹æ—¥é™é †ï¼‰
const allPosts = await getCollection('blog', ({ data }) => !data.draft);

// å…¬é–‹æ—¥ã§é™é †ã‚½ãƒ¼ãƒˆ
const sortedPosts = allPosts.sort((a, b) => b.data.pubDate.getTime() - a.data.pubDate.getTime());

// 1ãƒšãƒ¼ã‚¸ç›®ã®ãƒ‡ãƒ¼ã‚¿ã‚’ä½œæˆ
const posts = sortedPosts.slice(0, PAGE_SIZE);
const totalPages = Math.ceil(sortedPosts.length / PAGE_SIZE);

// Paginationã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆç”¨ã®pageã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’æ‰‹å‹•ã§ä½œæˆ
const page = {
  data: posts,
  start: 0,
  end: Math.min(PAGE_SIZE - 1, sortedPosts.length - 1),
  size: PAGE_SIZE,
  total: sortedPosts.length,
  currentPage: 1,
  lastPage: totalPages,
  url: {
    current: '/blog',
    prev: undefined,
    next: totalPages > 1 ? '/blog/2' : undefined,
    first: '/blog',
    last: totalPages > 1 ? `/blog/${totalPages}` : '/blog',
  },
};
---

<BaseLayout currentPath="/blog" title="ãƒ–ãƒ­ã‚°è¨˜äº‹ä¸€è¦§" description="æŠ€è¡“ãƒ–ãƒ­ã‚°ã®è¨˜äº‹ä¸€è¦§ã§ã™">

  <div class="container-narrow py-12">
    <header class="mb-8">
      <h1 class="text-4xl font-bold mb-2">ãƒ–ãƒ­ã‚°è¨˜äº‹ä¸€è¦§</h1>
      <p class="text-gray-600 dark:text-gray-400">
        å…¨{page.total}ä»¶ä¸­ 1ã€œ{Math.min(PAGE_SIZE, page.total)}ä»¶ã‚’è¡¨ç¤º
      </p>
    </header>

    <!-- è¨˜äº‹ä¸€è¦§ -->
    <ul class="space-y-8" role="list" aria-label="ãƒ–ãƒ­ã‚°è¨˜äº‹ä¸€è¦§">
      {page.data.map((post) => (
        <li>
          <article class="border border-gray-200 dark:border-gray-700 rounded-lg p-6 hover:shadow-lg transition-shadow">
            <a
              href={`/blog/${post.id}`}
              class="block group"
              aria-label={`${post.data.title}ã‚’èª­ã‚€`}
            >
              <h2 class="text-2xl font-semibold mb-2 group-hover:text-blue-600 dark:group-hover:text-blue-400 transition-colors">
                {post.data.title}
              </h2>
              <p class="text-gray-600 dark:text-gray-400 mb-4">
                {post.data.description}
              </p>
              <div class="flex flex-wrap items-center gap-4 text-sm text-gray-500 dark:text-gray-500">
                <time datetime={post.data.pubDate.toISOString()}>
                  {post.data.pubDate.toLocaleDateString('ja-JP', {
                    year: 'numeric',
                    month: 'long',
                    day: 'numeric',
                  })}
                </time>
                {post.data.tags.length > 0 && (
                  <div class="flex flex-wrap gap-2" aria-label="ã‚¿ã‚°">
                    {post.data.tags.map((tag) => (
                      <span class="bg-gray-100 dark:bg-gray-800 px-2 py-1 rounded text-xs">
                        {tag}
                      </span>
                    ))}
                  </div>
                )}
              </div>
            </a>
          </article>
        </li>
      ))}
    </ul>

    <!-- ãƒšãƒ¼ã‚¸ãƒãƒ¼ã‚·ãƒ§ãƒ³ -->
    <Pagination page={page} />
  </div>

</BaseLayout>
