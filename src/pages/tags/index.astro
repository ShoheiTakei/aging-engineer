---
/**
 * „Çø„Ç∞‰∏ÄË¶ß„Éö„Éº„Ç∏
 *
 * Ë¶Å‰ª∂:
 * - TASK-0017: „Çø„Ç∞‰∏ÄË¶ß„Éö„Éº„Ç∏„ÅÆÂÆüË£Ö
 * - REQ-302: „Çø„Ç∞‰∏ÄË¶ß„Éö„Éº„Ç∏„ÅÆÊèê‰æõÔºàÂÖ®„Çø„Ç∞Ë°®Á§∫„ÄÅË®ò‰∫ãÊï∞Ë°®Á§∫Ôºâ
 * - TC-301-01: „Çø„Ç∞‰∏ÄË¶ß„Éö„Éº„Ç∏„ÅÆË°®Á§∫
 * - TC-301-B01: „Çø„Ç∞„Åå1‰ª∂„ÇÇ„Å™„ÅÑÂ†¥Âêà„ÅÆË°®Á§∫
 * - NFR-301: „Çª„Éû„É≥„ÉÜ„Ç£„ÉÉ„ÇØHTML‰ΩøÁî®
 * - NFR-302: „Ç≠„Éº„Éú„Éº„Éâ„Éä„Éì„Ç≤„Éº„Ç∑„Éß„É≥ÂØæÂøú
 * - NFR-101ÔΩûNFR-102: SEOÂØæÂøúÔºà„É°„Çø„Çø„Ç∞„ÄÅOGPÔºâ
 *
 * ‰ø°È†ºÊÄß: üîµ „ÉÜ„Çπ„Éà„Ç±„Éº„ÇπÂÆöÁæ©„ÉªË¶Å‰ª∂ÂÆöÁæ©„Çà„Çä
 */

import { getCollection } from 'astro:content';
import BaseLayout from '../../layouts/BaseLayout.astro';

// „Äê„Éá„Éº„ÇøÂèñÂæó„Äë: ÂÖ®Ë®ò‰∫ã„ÇíÂèñÂæóÔºà‰∏ãÊõ∏„ÅçÈô§Â§ñÔºâ
// üîµ ‰ø°È†ºÊÄß„É¨„Éô„É´: REQ-302„ÄÅarchitecture.md „Çà„Çä
const allPosts = await getCollection('blog', ({ data }) => {
  return data.draft !== true;
});

// „Äê„Çø„Ç∞ÊäΩÂá∫„Äë: „Åô„Åπ„Å¶„ÅÆ„Çø„Ç∞„ÇíÈáçË§á„Å™„ÅèÊäΩÂá∫
// üîµ ‰ø°È†ºÊÄß„É¨„Éô„É´: „ÉÜ„Çπ„Éà„Ç±„Éº„ÇπTC-TL-001„Çà„Çä
const allTags = [...new Set(allPosts.flatMap((post) => post.data.tags || []))];

// „Äê„Çø„Ç∞„Ç´„Ç¶„É≥„Éà„Äë: ÂêÑ„Çø„Ç∞„ÅÆË®ò‰∫ãÊï∞„Çí„Ç´„Ç¶„É≥„Éà
// üîµ ‰ø°È†ºÊÄß„É¨„Éô„É´: „ÉÜ„Çπ„Éà„Ç±„Éº„ÇπTC-TL-001„ÄÅTC-TL-003„Çà„Çä
const tagCounts = allTags.map((tag) => ({
  name: tag,
  count: allPosts.filter((post) => post.data.tags?.includes(tag)).length,
}));

// „Äê„ÇΩ„Éº„Éà„Äë: „Çø„Ç∞Âêç„Åß„Ç¢„É´„Éï„Ç°„Éô„ÉÉ„ÉàÈ†Ü„Å´„ÇΩ„Éº„Éà
const sortedTags = tagCounts.sort((a, b) => a.name.localeCompare(b.name));
---

<BaseLayout
  title="„Çø„Ç∞‰∏ÄË¶ß"
  description="„Éñ„É≠„Ç∞Ë®ò‰∫ã„ÅÆ„Çø„Ç∞‰∏ÄË¶ß„Åß„Åô„ÄÇ„Çø„Ç∞„Çí„ÇØ„É™„ÉÉ„ÇØ„Åô„Çã„Å®„ÄÅ„Åù„ÅÆ„Çø„Ç∞„Åå‰ªò„ÅÑ„ÅüË®ò‰∫ã„ÅÆ‰∏ÄË¶ß„ÇíË°®Á§∫„Åó„Åæ„Åô„ÄÇ"
  url="/tags/"
  type="website"
>
  <div class="container-narrow py-12">
    <!-- „Äê„Éò„ÉÉ„ÉÄ„Éº„Äë: „Éö„Éº„Ç∏„Çø„Ç§„Éà„É´„Å®Ë™¨Êòé -->
    <header class="mb-8">
      <h1 class="text-4xl font-bold mb-2">„Çø„Ç∞‰∏ÄË¶ß</h1>
      <p class="text-gray-600 dark:text-gray-400">
        ÂÖ®{sortedTags.length}‰ª∂„ÅÆ„Çø„Ç∞
      </p>
    </header>

    <!-- „Äê„Çø„Ç∞„É™„Çπ„Éà„Äë: „Çø„Ç∞„ÅåÂ≠òÂú®„Åô„ÇãÂ†¥Âêà -->
    {
      sortedTags.length > 0 ? (
        <ul class="space-y-4" role="list" aria-label="„Çø„Ç∞‰∏ÄË¶ß">
          {sortedTags.map((tag) => (
            <li>
              <a
                href={`/tags/${encodeURIComponent(tag.name)}/`}
                class="block p-4 border border-gray-200 dark:border-gray-700 rounded-lg hover:shadow-lg hover:border-blue-500 dark:hover:border-blue-400 transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-blue-500 dark:focus-visible:ring-blue-400"
                aria-label={`${tag.name}„Çø„Ç∞„ÅÆË®ò‰∫ã‰∏ÄË¶ß„ÇíË°®Á§∫Ôºà${tag.count}‰ª∂Ôºâ`}
              >
                <div class="flex items-center justify-between">
                  <span class="text-xl font-semibold text-gray-900 dark:text-gray-100">
                    {tag.name}
                  </span>
                  <span class="text-sm text-gray-600 dark:text-gray-400 bg-gray-100 dark:bg-gray-800 px-3 py-1 rounded-full">
                    {tag.count}‰ª∂
                  </span>
                </div>
              </a>
            </li>
          ))}
        </ul>
      ) : (
        <!-- „Äê„Ç®„ÉÉ„Ç∏„Ç±„Éº„Çπ„Äë: „Çø„Ç∞„Åå1‰ª∂„ÇÇ„Å™„ÅÑÂ†¥Âêà -->
        <!-- üîµ ‰ø°È†ºÊÄß„É¨„Éô„É´: TC-301-B01„ÄÅEDGE-001„Çà„Çä -->
        <div class="text-center py-12">
          <p class="text-gray-600 dark:text-gray-400 text-lg">
            „Çø„Ç∞„Åå„ÅÇ„Çä„Åæ„Åõ„Çì
          </p>
        </div>
      )
    }
  </div>
</BaseLayout>
