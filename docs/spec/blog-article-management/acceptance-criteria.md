# ブログ記事管理機能 受け入れ基準

**作成日**: 2025-12-28
**関連要件定義**: [requirements.md](requirements.md)
**関連ユーザストーリー**: [user-stories.md](user-stories.md)
**ヒアリング記録**: [interview-record.md](interview-record.md)

**【信頼性レベル凡例】**:
- 🔵 **青信号**: PRD・EARS要件定義書・設計文書・ユーザヒアリングを参考にした確実な基準
- 🟡 **黄信号**: PRD・EARS要件定義書・設計文書・ユーザヒアリングから妥当な推測による基準
- 🔴 **赤信号**: PRD・EARS要件定義書・設計文書・ユーザヒアリングにない推測による基準

---

## REQ-001: Markdown形式での記事作成 🔵

**信頼性**: 🔵 *tech-stack.md、ユーザヒアリングより*

### Given（前提条件）
- Astroプロジェクトが初期化されている
- Content Collections APIが設定されている（`src/content/config.ts`）
- `src/content/blog/`ディレクトリが存在する

### When（実行条件）
- ユーザーが`src/content/blog/new-post.md`を作成し、frontmatterと本文を記述

### Then（期待結果）
- ビルド時にMarkdownファイルが認識される
- frontmatterがパースされ、型安全に扱える
- 本文がHTMLに変換される

### テストケース

#### 正常系

- [ ] **TC-001-01**: 最小限のfrontmatterで記事を作成 🔵
  - **入力**: `title: "Test", description: "Test desc", pubDate: 2025-12-28`
  - **期待結果**: ビルド成功、記事一覧に表示される
  - **信頼性**: 🔵 *tech-stack.md・Content Collections仕様より*

- [ ] **TC-001-02**: 全フィールドを含むfrontmatterで記事を作成 🔵
  - **入力**: title, description, pubDate, updatedDate, coverImage, tags, draft
  - **期待結果**: すべてのフィールドが正しくパースされる
  - **信頼性**: 🔵 *tech-stack.md・frontmatter仕様より*

- [ ] **TC-001-03**: Markdown記法が正しくHTMLに変換される 🔵
  - **入力**: 見出し、リスト、リンク、コードブロック、画像を含むMarkdown
  - **期待結果**: 対応するHTMLタグに変換される
  - **信頼性**: 🔵 *Astro Markdown処理の標準動作*

#### 異常系

- [ ] **TC-001-E01**: 必須フィールド（title）が欠けている 🔵
  - **入力**: `description: "Test", pubDate: 2025-12-28`（titleなし）
  - **期待結果**: ビルドエラー、型チェックエラー
  - **信頼性**: 🔵 *Content Collections型定義より*

- [ ] **TC-001-E02**: 無効な日付形式 🔵
  - **入力**: `pubDate: "invalid-date"`
  - **期待結果**: ビルドエラー、zodバリデーションエラー
  - **信頼性**: 🔵 *zodスキーマ定義より*

---

## REQ-101: 記事一覧ページの提供 🔵

**信頼性**: 🔵 *tech-stack.md、ユーザヒアリングより*

### Given（前提条件）
- 複数の記事が`src/content/blog/`に存在する
- 記事一覧ページ（`/blog/`）が実装されている

### When（実行条件）
- ユーザーが`/blog/`にアクセス

### Then（期待結果）
- 記事一覧が表示される
- 各記事にタイトル、説明、公開日、タグ、カバー画像、読了時間が表示される
- 新しい順に並んでいる

### テストケース

#### 正常系

- [ ] **TC-101-01**: 記事が5件未満の場合、全件表示 🔵
  - **入力**: 3件の記事
  - **期待結果**: 3件すべてが表示、ページネーションなし
  - **信頼性**: 🔵 *ユーザヒアリング Q1, Q11より*

- [ ] **TC-101-02**: 記事が6件以上の場合、5件ずつ表示 🔵
  - **入力**: 12件の記事
  - **期待結果**: 1ページ目に最新5件、2ページ目に次の5件、3ページ目に残り2件
  - **信頼性**: 🔵 *ユーザヒアリング Q11より*

- [ ] **TC-101-03**: カバー画像がない記事も正しく表示 🟡
  - **入力**: coverImageフィールドがない記事
  - **期待結果**: テキスト情報のみ表示、レイアウト崩れなし
  - **信頼性**: 🟡 *一般的なブログUIパターンより*

#### 異常系

- [ ] **TC-101-E01**: 記事が存在しない場合 🔵
  - **入力**: 記事0件
  - **期待結果**: 「記事がありません」メッセージ表示
  - **信頼性**: 🔵 *ユーザヒアリング Q17より*

---

## REQ-201: ページネーション機能 🔵

**信頼性**: 🔵 *ユーザヒアリング Q1, Q11より*

### Given（前提条件）
- 6件以上の記事が存在する
- ページネーション機能が実装されている

### When（実行条件）
- ユーザーが`/blog/`または`/blog/2/`にアクセス

### Then（期待結果）
- 1ページあたり5件表示
- ページ番号ボタンが表示
- 前へ・次へボタンが表示
- 現在のページがハイライト

### テストケース

#### 正常系

- [ ] **TC-201-01**: 1ページ目の表示 🔵
  - **入力**: `/blog/`にアクセス
  - **期待結果**: 最新5件、「次へ」ボタン有効、「前へ」ボタン無効
  - **信頼性**: 🔵 *ユーザヒアリング Q1より*

- [ ] **TC-201-02**: 2ページ目の表示 🔵
  - **入力**: `/blog/2/`にアクセス
  - **期待結果**: 6～10件目、「前へ」「次へ」両方有効
  - **信頼性**: 🔵 *ユーザヒアリング Q1より*

- [ ] **TC-201-03**: 最終ページの表示 🔵
  - **入力**: 12件中の`/blog/3/`にアクセス
  - **期待結果**: 11～12件目、「前へ」ボタン有効、「次へ」ボタン無効
  - **信頼性**: 🔵 *ユーザヒアリング Q1より*

#### 境界値

- [ ] **TC-201-B01**: ちょうど5件の場合、ページネーション非表示 🟡
  - **入力**: 5件の記事
  - **期待結果**: 5件すべて表示、ページネーションなし
  - **信頼性**: 🟡 *一般的なページネーション動作より*

---

## REQ-301～REQ-303: タグ機能 🔵

**信頼性**: 🔵 *ユーザヒアリング Q2より*

### Given（前提条件）
- 複数の記事に異なるタグが設定されている
- タグ一覧ページ（`/tags/`）、タグ別ページ（`/tags/[tag]/`）が実装されている

### When（実行条件）
- ユーザーが`/tags/`または`/tags/typescript/`にアクセス

### Then（期待結果）
- タグ一覧、またはタグ別記事一覧が表示される

### テストケース

#### 正常系

- [ ] **TC-301-01**: タグ一覧ページの表示 🔵
  - **入力**: `/tags/`にアクセス
  - **期待結果**: すべてのタグがリスト表示、各タグの記事数が表示
  - **信頼性**: 🔵 *ユーザヒアリング Q2より*

- [ ] **TC-302-01**: タグ別記事一覧の表示 🔵
  - **入力**: `/tags/typescript/`にアクセス
  - **期待結果**: "typescript"タグを持つ記事のみ表示
  - **信頼性**: 🔵 *ユーザヒアリング Q2より*

- [ ] **TC-303-01**: タグなし記事の扱い 🔵
  - **入力**: `tags`フィールドがない記事
  - **期待結果**: タグ一覧に表示されない、記事一覧には表示される
  - **信頼性**: 🔵 *tech-stack.md frontmatter仕様より*

#### 境界値

- [ ] **TC-301-B01**: タグが1件もない場合 🟡
  - **入力**: すべての記事で`tags`フィールドなし
  - **期待結果**: 「タグがありません」メッセージ表示
  - **信頼性**: 🟡 *EDGE-001の類推より*

---

## REQ-401～REQ-402: 記事検索機能 🔵

**信頼性**: 🔵 *ユーザヒアリング Q3より*

### Given（前提条件）
- 検索機能が実装されている
- 複数の記事が存在する

### When（実行条件）
- ユーザーが検索ボックスにキーワードを入力して検索

### Then（期待結果）
- タイトルと本文から全文検索される
- 結果が関連度順に表示される
- 検索キーワードがハイライト表示される

### テストケース

#### 正常系

- [ ] **TC-401-01**: タイトルからの検索 🔵
  - **入力**: キーワード "Astro"
  - **期待結果**: タイトルに"Astro"を含む記事が表示
  - **信頼性**: 🔵 *ユーザヒアリング Q3より*

- [ ] **TC-401-02**: 本文からの検索 🔵
  - **入力**: キーワード "TypeScript"
  - **期待結果**: 本文に"TypeScript"を含む記事が表示
  - **信頼性**: 🔵 *ユーザヒアリング Q3より*

- [ ] **TC-402-01**: 関連度順のソート 🔵
  - **入力**: キーワード "test"
  - **期待結果**: 出現回数が多い記事が上位に表示
  - **信頼性**: 🔵 *ユーザヒアリング Q3より*

#### 異常系

- [ ] **TC-401-E01**: 検索結果が0件 🟡
  - **入力**: キーワード "存在しないワード"
  - **期待結果**: 「検索結果が見つかりませんでした」メッセージ表示
  - **信頼性**: 🟡 *一般的な検索UIパターンより*

---

## REQ-501～REQ-502: 下書き機能 🔵

**信頼性**: 🔵 *ユーザヒアリング Q4より*

### Given（前提条件）
- 記事に`draft: true`が設定されている

### When（実行条件）
- 本番環境または開発環境にアクセス

### Then（期待結果）
- 本番環境では下書き記事が非表示
- 開発環境では下書き記事も表示

### テストケース

#### 正常系

- [ ] **TC-501-01**: 本番環境で下書き記事が非表示 🔵
  - **入力**: `draft: true`の記事
  - **期待結果**: 記事一覧、タグページ、検索結果に表示されない
  - **信頼性**: 🔵 *ユーザヒアリング Q4より*

- [ ] **TC-502-01**: 開発環境で下書き記事が表示 🔵
  - **入力**: `draft: true`の記事、`pnpm dev`で起動
  - **期待結果**: 記事一覧に表示、タイトルに[Draft]バッジ付き
  - **信頼性**: 🔵 *ユーザヒアリング Q4より*

- [ ] **TC-501-02**: draftフィールドがない場合は公開扱い 🔵
  - **入力**: `draft`フィールドなしの記事
  - **期待結果**: 本番環境で表示される
  - **信頼性**: 🔵 *デフォルト動作より*

---

## REQ-601: RSS Feed生成 🔵

**信頼性**: 🔵 *tech-stack.md、ユーザヒアリング Q5より*

### Given（前提条件）
- RSS Feed生成機能が実装されている（`/rss.xml`）

### When（実行条件）
- ユーザーが`/rss.xml`にアクセス

### Then（期待結果）
- RSS 2.0形式のXMLが返される
- 最新20件の記事が含まれる

### テストケース

#### 正常系

- [ ] **TC-601-01**: RSS Feedの生成 🔵
  - **入力**: `/rss.xml`にアクセス
  - **期待結果**: XML形式のRSS 2.0フィード、最新20件含む
  - **信頼性**: 🔵 *ユーザヒアリング Q5より*

- [ ] **TC-601-02**: RSS Feedの内容検証 🔵
  - **入力**: `/rss.xml`の内容
  - **期待結果**: title, description, pubDate, linkフィールドが含まれる
  - **信頼性**: 🔵 *RSS 2.0仕様より*

#### 境界値

- [ ] **TC-601-B01**: 記事が20件未満の場合 🟡
  - **入力**: 10件の記事
  - **期待結果**: 10件すべてがRSSに含まれる
  - **信頼性**: 🟡 *一般的なRSS動作より*

---

## REQ-701: 関連記事表示 🔵

**信頼性**: 🔵 *ユーザヒアリング Q6より*

### Given（前提条件）
- 記事詳細ページに関連記事機能が実装されている
- タグが設定された記事が複数存在する

### When（実行条件）
- ユーザーが記事詳細ページにアクセス

### Then（期待結果）
- タグが一致する記事が最大5件表示される
- 現在の記事は除外される

### テストケース

#### 正常系

- [ ] **TC-701-01**: タグが一致する記事を表示 🔵
  - **入力**: "TypeScript", "Astro"タグを持つ記事を閲覧
  - **期待結果**: 同じタグを持つ他の記事が最大5件表示
  - **信頼性**: 🔵 *ユーザヒアリング Q6より*

- [ ] **TC-701-02**: タグが多く一致する記事を優先 🟡
  - **入力**: 2タグ一致記事と1タグ一致記事が存在
  - **期待結果**: 2タグ一致記事が優先的に表示
  - **信頼性**: 🟡 *関連記事レコメンド一般的な動作より*

#### 境界値

- [ ] **TC-701-B01**: 関連記事が0件の場合 🟡
  - **入力**: 他にタグが一致する記事がない
  - **期待結果**: 「関連記事がありません」メッセージ、または非表示
  - **信頼性**: 🟡 *一般的なUI動作より*

---

## REQ-801: 読了時間表示 🔵

**信頼性**: 🔵 *ユーザヒアリング Q9より*

### Given（前提条件）
- 読了時間計算機能が実装されている

### When（実行条件）
- ユーザーが記事一覧または記事詳細ページを閲覧

### Then（期待結果）
- 文字数から読了時間が自動計算される（500文字/分）
- "約N分で読めます"形式で表示

### テストケース

#### 正常系

- [ ] **TC-801-01**: 標準的な長さの記事（1500文字） 🔵
  - **入力**: 1500文字の記事
  - **期待結果**: "約3分で読めます"と表示
  - **信頼性**: 🔵 *ユーザヒアリング Q9より*

#### 境界値

- [ ] **TC-801-B01**: 1分未満の記事（200文字） 🟡
  - **入力**: 200文字の記事
  - **期待結果**: "1分未満で読めます"と表示
  - **信頼性**: 🟡 *EDGE-103より*

- [ ] **TC-801-B02**: 非常に長い記事（5000文字） 🔵
  - **入力**: 5000文字の記事
  - **期待結果**: "約10分で読めます"と表示
  - **信頼性**: 🔵 *計算ロジックより*

---

## REQ-901: 目次自動生成 🔵

**信頼性**: 🔵 *ユーザヒアリング Q10より*

### Given（前提条件）
- 目次自動生成機能が実装されている
- 記事にh2, h3見出しが含まれる

### When（実行条件）
- ユーザーが記事詳細ページにアクセス

### Then（期待結果）
- h2, h3見出しから目次が生成される
- 階層構造が維持される
- 見出しへのアンカーリンク付き

### テストケース

#### 正常系

- [ ] **TC-901-01**: h2見出しのみの記事 🔵
  - **入力**: h2見出しが3つある記事
  - **期待結果**: フラットな目次リストが生成
  - **信頼性**: 🔵 *ユーザヒアリング Q10より*

- [ ] **TC-901-02**: h2とh3が混在する記事 🔵
  - **入力**: h2の下にh3がネストされた記事
  - **期待結果**: 階層構造を持つ目次が生成
  - **信頼性**: 🔵 *ユーザヒアリング Q10より*

- [ ] **TC-901-03**: 目次リンクのクリック 🔵
  - **入力**: 目次項目をクリック
  - **期待結果**: 該当見出しにスムーズスクロール
  - **信頼性**: 🔵 *ユーザヒアリング Q10より*

#### 境界値

- [ ] **TC-901-B01**: 見出しが存在しない記事 🟡
  - **入力**: h2, h3が含まれない記事
  - **期待結果**: 目次セクションが非表示
  - **信頼性**: 🟡 *EDGE-104より*

---

## REQ-111: シンタックスハイライト 🔵

**信頼性**: 🔵 *ユーザヒアリング Q18より*

### Given（前提条件）
- Shikiが設定されている
- コードブロックを含む記事が存在する

### When（実行条件）
- ユーザーが記事詳細ページにアクセス

### Then（期待結果）
- コードブロックにシンタックスハイライトが適用される

### テストケース

#### 正常系

- [ ] **TC-111-01**: TypeScriptコードのハイライト 🔵
  - **入力**: `` ```typescript `` コードブロック
  - **期待結果**: TypeScript構文がハイライト表示
  - **信頼性**: 🔵 *ユーザヒアリング Q18、Shiki標準機能より*

- [ ] **TC-111-02**: 複数言語のサポート 🔵
  - **入力**: JavaScript, Python, Bash等のコードブロック
  - **期待結果**: 各言語の構文がハイライト表示
  - **信頼性**: 🔵 *Shiki標準機能より*

---

## 非機能要件テスト

### NFR-001: パフォーマンス 🔵

**信頼性**: 🔵 *tech-stack.md品質基準、ユーザヒアリング Q13より*

- [ ] **TC-NFR-001-01**: Lighthouseスコア測定
  - **測定項目**: Performance, Accessibility, Best Practices, SEO
  - **目標値**: 各90+点
  - **測定条件**: 本番ビルド、シークレットモード、3G回線シミュレーション
  - **信頼性**: 🔵 *tech-stack.md品質基準より*

### NFR-101～NFR-104: SEO 🔵

**信頼性**: 🔵 *ユーザヒアリング Q14より*

- [ ] **TC-NFR-101-01**: メタタグ検証
  - **検証内容**: title, description, keywords
  - **期待結果**: 各記事に適切なメタタグが設定
  - **信頼性**: 🔵 *ユーザヒアリング Q14より*

- [ ] **TC-NFR-102-01**: OGPタグ検証
  - **検証内容**: og:title, og:description, og:type, og:url
  - **期待結果**: 各記事にOGPタグが設定（og:imageは除く）
  - **信頼性**: 🔵 *ユーザヒアリング Q7, Q14より*

- [ ] **TC-NFR-103-01**: サイトマップ生成
  - **検証内容**: /sitemap.xml
  - **期待結果**: 全記事URLが含まれる
  - **信頼性**: 🔵 *ユーザヒアリング Q14より*

- [ ] **TC-NFR-104-01**: JSON-LD検証
  - **検証内容**: BlogPosting構造化データ
  - **期待結果**: headline, datePublished, author等が含まれる
  - **信頼性**: 🔵 *ユーザヒアリング Q14より*

### NFR-201～NFR-203: 画像最適化 🔵

**信頼性**: 🔵 *ユーザヒアリング Q15より*

- [ ] **TC-NFR-201-01**: Cloudflare R2からの画像配信
  - **検証内容**: 記事内画像のURL
  - **期待結果**: R2バケットのURLから配信
  - **信頼性**: 🔵 *tech-stack.md、ユーザヒアリングより*

- [ ] **TC-NFR-202-01**: WebP/AVIF変換
  - **検証内容**: Astro Imageコンポーネントの出力
  - **期待結果**: WebP/AVIF形式の画像が生成、srcset対応
  - **信頼性**: 🔵 *ユーザヒアリング Q15より*

### NFR-301～NFR-304: アクセシビリティ 🔵

**信頼性**: 🔵 *ユーザヒアリング Q16より*

- [ ] **TC-NFR-301-01**: セマンティックHTML検証
  - **検証内容**: article, header, nav, main, footer要素の使用
  - **期待結果**: 適切なHTML5セマンティック要素が使用されている
  - **信頼性**: 🔵 *ユーザヒアリング Q16より*

- [ ] **TC-NFR-302-01**: キーボードナビゲーション
  - **検証内容**: Tabキーでの移動、Enterキーでのリンク実行
  - **期待結果**: すべてのインタラクティブ要素が操作可能
  - **信頼性**: 🔵 *ユーザヒアリング Q16より*

- [ ] **TC-NFR-304-01**: 画像alt属性検証
  - **検証内容**: すべての画像要素
  - **期待結果**: alt属性が設定されている
  - **信頼性**: 🔵 *ユーザヒアリング Q16より*

---

## Edgeケーステスト

### EDGE-001: 空状態表示 🔵

**信頼性**: 🔵 *ユーザヒアリング Q17より*

- [ ] **TC-EDGE-001-01**: 記事0件の一覧ページ
  - **条件**: 記事が存在しない
  - **期待結果**: 「記事がありません」メッセージ表示
  - **信頼性**: 🔵 *ユーザヒアリング Q17より*

### EDGE-002: 404ページ 🟡

**信頼性**: 🟡 *一般的なWebアプリケーション慣習より*

- [ ] **TC-EDGE-002-01**: 存在しないslugへのアクセス
  - **条件**: `/blog/non-existent-post/`にアクセス
  - **期待結果**: 404ページ表示
  - **信頼性**: 🟡 *Webアプリケーション標準動作より*

---

## テストケースサマリー

### カテゴリ別件数

| カテゴリ | 正常系 | 異常系 | 境界値 | 合計 |
|---------|--------|--------|--------|------|
| 機能要件 | 28 | 4 | 8 | 40 |
| 非機能要件 | 9 | 0 | 0 | 9 |
| Edgeケース | 2 | 0 | 0 | 2 |
| **合計** | 39 | 4 | 8 | 51 |

### 信頼性レベル分布

- 🔵 青信号: 41件 (80%)
- 🟡 黄信号: 10件 (20%)
- 🔴 赤信号: 0件 (0%)

**品質評価**: ✅ 高品質 - 大部分のテストケースがユーザヒアリングと既存設計に基づいており、信頼性が高い

### 優先度別テストケース

- **Must Have**: 35件
- **Should Have**: 16件
- **Could Have**: 0件

---

## テスト実施計画

### Phase 1: 基本機能テスト（Week 1-2）
- REQ-001～REQ-011（記事CRUD）
- REQ-101～REQ-112（記事表示）
- 優先度: Must Have
- 実施予定: プロジェクト開始後1-2週間

### Phase 2: 拡張機能テスト（Week 3）
- REQ-201～REQ-303（ページネーション、タグ）
- REQ-401～REQ-701（検索、下書き、RSS、関連記事）
- 優先度: Must Have + Should Have
- 実施予定: プロジェクト開始後3週間

### Phase 3: 補助機能テスト（Week 4）
- REQ-801～REQ-901（読了時間、目次）
- REQ-111（シンタックスハイライト）
- 優先度: Should Have
- 実施予定: プロジェクト開始後4週間

### Phase 4: 非機能・Edgeケーステスト（Week 5）
- NFR-001～NFR-999（パフォーマンス、SEO、画像最適化、アクセシビリティ）
- EDGE-001～EDGE-999（エラー処理、境界値）
- 優先度: Must Have（非機能要件）
- 実施予定: プロジェクト開始後5週間

### 継続的テスト
- Lighthouse CI: 各PR時に自動実行
- Vitest単体テスト: 各コミット時に実行
- Playwright E2Eテスト: デプロイ前に実行
