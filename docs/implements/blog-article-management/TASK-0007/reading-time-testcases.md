# TASK-0007: 読了時間計算ユーティリティ テストケース定義書

**作成日**: 2026-01-01
**タスクID**: TASK-0007
**タスクタイプ**: TDD
**関連要件**: REQ-801, EDGE-103

---

## テストケース概要

**機能名**: 読了時間計算ユーティリティ（reading-time）
**実装ファイル**: `src/utils/readingTime.ts`
**テストファイル**: `src/utils/readingTime.test.ts`

### 関連ドキュメント

- 要件定義書: `docs/implements/blog-article-management/TASK-0007/reading-time-requirements.md`
- タスクノート: `docs/implements/blog-article-management/TASK-0007/note.md`
- 受け入れ基準: `docs/spec/blog-article-management/acceptance-criteria.md`
- テストパターン: `docs/design/frontend-test-infra/test-patterns.md`

---

## 1. 開発言語・フレームワーク

### 1.1 プログラミング言語 🔵

- **言語**: TypeScript 5.7+
- **言語選択の理由**: プロジェクト全体で採用しているTypeScriptを使用、strict modeによる型安全性確保
- **テストに適した機能**: 型推論、インターフェース定義、コンパイル時型チェック

### 1.2 テストフレームワーク 🔵

- **フレームワーク**: Vitest 2.1.8
- **フレームワーク選択の理由**: Astro/Viteとの統合が良好、高速な実行、Jestライクな記法
- **テスト実行環境**: happy-dom 20.0.11（DOM環境シミュレーション）
- **実行コマンド**: `pnpm test`、`pnpm test:watch`

---

## 2. calculateReadingTime() テストケース

### 2.1 正常系テストケース

#### TC-RT-001: 標準的な記事長（1500文字）で約3分を返す 🔵

- **テスト名**: 標準的な記事長（1500文字）で約3分を返す
  - **何をテストするか**: 1500文字の記事本文を渡した場合、読了時間が3分と計算されること
  - **期待される動作**: 文字数を500で割り、切り上げで3分を返す
- **入力値**: 1500文字の文字列（例: `'あ'.repeat(1500)`）
  - **入力データの意味**: 一般的なブログ記事の長さを代表する値
- **期待される結果**: `3`（数値）
  - **期待結果の理由**: 1500 / 500 = 3（ちょうど割り切れる）
- **テストの目的**: 基本的な読了時間計算機能の動作確認
  - **確認ポイント**: 500文字/分の計算が正しく行われること
- 🔵 信頼性レベル: requirements.md REQ-801・acceptance-criteria.md TC-801-01より

**参照**: requirements.md REQ-801、acceptance-criteria.md TC-801-01

---

#### TC-RT-002: 長い記事（5000文字）で約10分を返す 🔵

- **テスト名**: 長い記事（5000文字）で約10分を返す
  - **何をテストするか**: 5000文字の長い記事を渡した場合、読了時間が10分と計算されること
  - **期待される動作**: 文字数を500で割り、切り上げで10分を返す
- **入力値**: 5000文字の文字列（例: `'あ'.repeat(5000)`）
  - **入力データの意味**: 詳細な解説記事など長い記事を代表する値
- **期待される結果**: `10`（数値）
  - **期待結果の理由**: 5000 / 500 = 10（ちょうど割り切れる）
- **テストの目的**: 長い記事でも正しく計算されることの確認
  - **確認ポイント**: 大きな文字数でも計算が正常に動作すること
- 🔵 信頼性レベル: acceptance-criteria.md TC-801-B02より

**参照**: acceptance-criteria.md TC-801-B02

---

#### TC-RT-003: 端数がある記事（1600文字）で切り上げ4分を返す 🔵

- **テスト名**: 端数がある記事（1600文字）で切り上げ4分を返す
  - **何をテストするか**: 端数が出る文字数の記事を渡した場合、切り上げで計算されること
  - **期待される動作**: 文字数を500で割り、Math.ceilで切り上げ
- **入力値**: 1600文字の文字列（例: `'あ'.repeat(1600)`）
  - **入力データの意味**: 500の倍数でない、一般的な記事長
- **期待される結果**: `4`（数値）
  - **期待結果の理由**: 1600 / 500 = 3.2 → Math.ceil(3.2) = 4
- **テストの目的**: 切り上げ処理の動作確認
  - **確認ポイント**: Math.ceil()による切り上げが正しく適用されること
- 🔵 信頼性レベル: requirements.md REQ-801・note.mdの計算ロジックより

**参照**: requirements.md REQ-801、note.md

---

### 2.2 異常系テストケース

#### TC-RT-101: 空文字列で0分を返す 🔵

- **テスト名**: 空文字列で0分を返す
  - **エラーケースの概要**: 本文が空の場合の処理
  - **エラー処理の重要性**: コンテンツがない記事でもエラーにならないことを保証
- **入力値**: `''`（空文字列）
  - **不正な理由**: 通常の記事では本文が存在するが、ドラフトや特殊ケースで空の可能性
  - **実際の発生シナリオ**: ドラフト記事、メタデータのみの記事
- **期待される結果**: `0`（数値）
  - **エラーメッセージの内容**: エラーではなく0を返す
  - **システムの安全性**: 例外をスローせず正常に処理
- **テストの目的**: 空文字列の安全な処理確認
  - **品質保証の観点**: エッジケースでの堅牢性確保
- 🔵 信頼性レベル: note.mdの「空文字列・短い記事の処理」より

**参照**: note.md セクション5.1「空文字列・短い記事の処理」

---

### 2.3 境界値テストケース

#### TC-RT-201: 499文字（1分未満境界）で1分を返す 🔵

- **テスト名**: 499文字（1分未満境界）で1分を返す
  - **境界値の意味**: 500文字/分の計算で1分未満になる最大値
  - **境界値での動作保証**: 切り上げにより最低1分になること
- **入力値**: 499文字の文字列（例: `'あ'.repeat(499)`）
  - **境界値選択の根拠**: 500 - 1 = 499（500未満の最大整数）
  - **実際の使用場面**: 非常に短い記事や概要文
- **期待される結果**: `1`（数値）
  - **境界での正確性**: Math.ceil(499 / 500) = Math.ceil(0.998) = 1
  - **一貫した動作**: 1分未満でも1分と表示
- **テストの目的**: 1分境界での切り上げ動作確認
  - **堅牢性の確認**: 極端に短い記事でも正しく計算
- 🔵 信頼性レベル: note.mdの境界値テスト例より

**参照**: note.md セクション2.1「境界値テスト」

---

#### TC-RT-202: 500文字（ちょうど1分）で1分を返す 🔵

- **テスト名**: 500文字（ちょうど1分）で1分を返す
  - **境界値の意味**: 読了速度の基準値にちょうど一致する文字数
  - **境界値での動作保証**: 割り切れる場合の正確な計算
- **入力値**: 500文字の文字列（例: `'あ'.repeat(500)`）
  - **境界値選択の根拠**: 読了速度定数（CHARS_PER_MINUTE）と同値
  - **実際の使用場面**: 短い記事やニュース要約
- **期待される結果**: `1`（数値）
  - **境界での正確性**: 500 / 500 = 1（ちょうど割り切れる）
  - **一貫した動作**: 整数結果の正確な返却
- **テストの目的**: 基準値境界での正確な計算確認
  - **堅牢性の確認**: 定数値での動作保証
- 🔵 信頼性レベル: note.mdの境界値テスト例より

**参照**: note.md セクション2.1「境界値テスト」

---

#### TC-RT-203: 501文字（1分超え境界）で2分を返す 🔵

- **テスト名**: 501文字（1分超え境界）で2分を返す
  - **境界値の意味**: 500文字を1文字でも超えた場合の動作
  - **境界値での動作保証**: 切り上げにより2分になること
- **入力値**: 501文字の文字列（例: `'あ'.repeat(501)`）
  - **境界値選択の根拠**: 500 + 1 = 501（500超過の最小整数）
  - **実際の使用場面**: 500文字をわずかに超える記事
- **期待される結果**: `2`（数値）
  - **境界での正確性**: Math.ceil(501 / 500) = Math.ceil(1.002) = 2
  - **一貫した動作**: 1文字でも超えれば次の分数に切り上げ
- **テストの目的**: 境界超過時の切り上げ動作確認
  - **堅牢性の確認**: 境界付近での正確な切り上げ
- 🔵 信頼性レベル: note.mdの境界値テスト例より

**参照**: note.md セクション2.1「境界値テスト」

---

#### TC-RT-204: 1文字で1分を返す 🟡

- **テスト名**: 1文字で1分を返す
  - **境界値の意味**: 最小の有効な入力値
  - **境界値での動作保証**: 極端に短い入力でも正しく計算
- **入力値**: 1文字の文字列（例: `'あ'`）
  - **境界値選択の根拠**: 空でない最小の文字列
  - **実際の使用場面**: テストデータ、極端に短い記事
- **期待される結果**: `1`（数値）
  - **境界での正確性**: Math.ceil(1 / 500) = Math.ceil(0.002) = 1
  - **一貫した動作**: 最小入力でも動作
- **テストの目的**: 最小入力での動作確認
  - **堅牢性の確認**: 極端なエッジケースでの安定動作
- 🟡 信頼性レベル: note.mdからの妥当な推測

---

#### TC-RT-205: 200文字（1分未満）で1分を返す 🔵

- **テスト名**: 200文字（1分未満）で1分を返す
  - **境界値の意味**: 受け入れ基準で定義された「1分未満」の代表値
  - **境界値での動作保証**: 1分未満でも計算上は1分を返す
- **入力値**: 200文字の文字列（例: `'あ'.repeat(200)`）
  - **境界値選択の根拠**: acceptance-criteria.md TC-801-B01で指定
  - **実際の使用場面**: 短いお知らせ記事、概要
- **期待される結果**: `1`（数値）
  - **境界での正確性**: Math.ceil(200 / 500) = Math.ceil(0.4) = 1
  - **一貫した動作**: 受け入れ基準通りの動作
- **テストの目的**: 受け入れ基準のテストケース対応
  - **堅牢性の確認**: 仕様書通りの動作保証
- 🔵 信頼性レベル: acceptance-criteria.md TC-801-B01より

**参照**: acceptance-criteria.md TC-801-B01

---

## 3. formatReadingTime() テストケース

### 3.1 正常系テストケース

#### TC-FRT-001: 3分で「約3分で読めます」を返す 🔵

- **テスト名**: 3分で「約3分で読めます」を返す
  - **何をテストするか**: 通常の読了時間（分）を日本語表示形式に変換
  - **期待される動作**: テンプレート文字列で「約N分で読めます」を生成
- **入力値**: `3`（数値）
  - **入力データの意味**: 標準的な読了時間を代表する値
- **期待される結果**: `'約3分で読めます'`（文字列）
  - **期待結果の理由**: requirements.md REQ-801の表示形式に準拠
- **テストの目的**: 基本的なフォーマット機能の動作確認
  - **確認ポイント**: 「約N分で読めます」形式で出力されること
- 🔵 信頼性レベル: requirements.md REQ-801・acceptance-criteria.md TC-801-01より

**参照**: requirements.md REQ-801、acceptance-criteria.md TC-801-01

---

#### TC-FRT-002: 1分で「約1分で読めます」を返す 🔵

- **テスト名**: 1分で「約1分で読めます」を返す
  - **何をテストするか**: 最小の通常値（1分）での表示形式
  - **期待される動作**: 1分でも「約N分」形式で表示
- **入力値**: `1`（数値）
  - **入力データの意味**: 短い記事の読了時間
- **期待される結果**: `'約1分で読めます'`（文字列）
  - **期待結果の理由**: 1分以上は「約N分」形式
- **テストの目的**: 最小通常値での表示確認
  - **確認ポイント**: 1分が正しくフォーマットされること
- 🔵 信頼性レベル: requirements.md REQ-801より

**参照**: requirements.md REQ-801

---

#### TC-FRT-003: 10分で「約10分で読めます」を返す 🔵

- **テスト名**: 10分で「約10分で読めます」を返す
  - **何をテストするか**: 長い記事の読了時間表示
  - **期待される動作**: 2桁の分数も正しく表示
- **入力値**: `10`（数値）
  - **入力データの意味**: 長い記事の読了時間を代表
- **期待される結果**: `'約10分で読めます'`（文字列）
  - **期待結果の理由**: requirements.md REQ-801・acceptance-criteria.md TC-801-B02
- **テストの目的**: 2桁の分数での表示確認
  - **確認ポイント**: 数値の桁数に関わらず正しくフォーマット
- 🔵 信頼性レベル: acceptance-criteria.md TC-801-B02より

**参照**: acceptance-criteria.md TC-801-B02

---

### 3.2 境界値テストケース

#### TC-FRT-201: 0分で「1分未満で読めます」を返す 🟡

- **テスト名**: 0分で「1分未満で読めます」を返す
  - **境界値の意味**: 読了時間が0の場合の特殊表示
  - **境界値での動作保証**: 0分は「1分未満」として表示
- **入力値**: `0`（数値）
  - **境界値選択の根拠**: EDGE-103で定義された「1分未満」ケース
  - **実際の使用場面**: 空文字列または極めて短い記事
- **期待される結果**: `'1分未満で読めます'`（文字列）
  - **境界での正確性**: 0分は特殊ケースとして処理
  - **一貫した動作**: 「約0分」ではなく「1分未満」と表示
- **テストの目的**: 1分未満の特殊表示確認
  - **堅牢性の確認**: EDGE-103対応の動作保証
- 🟡 信頼性レベル: EDGE-103より（表示形式は推測）

**参照**: requirements.md EDGE-103、acceptance-criteria.md TC-801-B01

---

#### TC-FRT-202: 負の値で「1分未満で読めます」を返す 🟡

- **テスト名**: 負の値で「1分未満で読めます」を返す
  - **境界値の意味**: 不正な入力値（負数）の防御的処理
  - **境界値での動作保証**: 負の値も安全に処理
- **入力値**: `-1`（数値）
  - **境界値選択の根拠**: 0未満の最小整数
  - **実際の使用場面**: プログラムエラー、不正なデータ
- **期待される結果**: `'1分未満で読めます'`（文字列）
  - **境界での正確性**: 負の値は0以下として「1分未満」扱い
  - **一貫した動作**: 例外をスローせず安全に処理
- **テストの目的**: 不正入力の防御的処理確認
  - **堅牢性の確認**: 予期しない入力に対する安定動作
- 🟡 信頼性レベル: note.mdからの妥当な推測（防御的プログラミング）

---

#### TC-FRT-203: 大きな値（100分）で正しくフォーマット 🟡

- **テスト名**: 大きな値（100分）で正しくフォーマット
  - **境界値の意味**: 非常に長い記事の読了時間
  - **境界値での動作保証**: 大きな数値でも正しく表示
- **入力値**: `100`（数値）
  - **境界値選択の根拠**: 50,000文字相当の極端に長い記事
  - **実際の使用場面**: 連載記事、電子書籍レベルの長文
- **期待される結果**: `'約100分で読めます'`（文字列）
  - **境界での正確性**: 3桁の数値も正しく表示
  - **一貫した動作**: 数値の大きさに関わらず一貫した形式
- **テストの目的**: 大きな数値での表示確認
  - **堅牢性の確認**: 極端なケースでの安定動作
- 🟡 信頼性レベル: note.mdからの妥当な推測

---

## 4. テストケース実装時の日本語コメント指針

### 4.1 テストファイル全体のコメント

```typescript
/**
 * readingTime.ts - テストスイート
 *
 * 関連要件:
 * - REQ-801: 記事の読了時間を自動計算して表示（500文字/分）
 * - EDGE-103: 読了時間が1分未満の記事は「1分未満」と表示
 *
 * 関連文書:
 * - テストケース定義書: docs/implements/blog-article-management/TASK-0007/reading-time-testcases.md
 * - 要件定義書: docs/implements/blog-article-management/TASK-0007/reading-time-requirements.md
 * - タスクノート: docs/implements/blog-article-management/TASK-0007/note.md
 * - テストパターン: docs/design/frontend-test-infra/test-patterns.md
 */
```

### 4.2 describe/itブロックのコメント例

```typescript
describe('calculateReadingTime', () => {
  // ========================================
  // 正常系テストケース
  // ========================================

  describe('正常系テストケース', () => {
    // TC-RT-001: 標準的な記事長（1500文字）で約3分を返す 🔵
    it('TC-RT-001: 標準的な記事長（1500文字）で3分を返す', () => {
      // 【テスト目的】: calculateReadingTime()が標準的な記事長で正しく計算することを確認
      // 【テスト内容】: 1500文字の文字列を渡し、3分が返されるか検証
      // 【期待される動作】: 1500 / 500 = 3（ちょうど割り切れる）
      // 🔵 信頼性: requirements.md REQ-801・acceptance-criteria.md TC-801-01より

      // 【テストデータ準備】: 1500文字の日本語文字列を生成
      // 【前提条件確認】: 文字列長が1500であること
      const content = 'あ'.repeat(1500);

      // 【実際の処理実行】: calculateReadingTime関数を呼び出し
      // 【処理内容】: 文字数から読了時間（分）を計算
      const result = calculateReadingTime(content);

      // 【結果検証】: 3分が返されることを確認
      // 【期待値確認】: 1500 / 500 = 3
      // 【品質保証】: 基本的な読了時間計算が正しく動作すること
      // 🔵 信頼性: requirements.md REQ-801より
      expect(result).toBe(3); // 【確認内容】: 1500文字で3分
    });
  });
});
```

### 4.3 ヘルパー関数のコメント例

```typescript
// ========================================
// テストヘルパー関数
// ========================================

/**
 * 【ヘルパー関数】: 指定文字数のテスト用文字列を生成
 * 【再利用性】: 複数のテストケースで文字列生成に使用
 * 【単一責任】: テストデータ生成を担当
 * 🔵 信頼性レベル: note.mdのテストデータ準備例より
 *
 * @param length - 生成する文字数
 * @returns 指定文字数の日本語文字列
 */
function generateText(length: number): string {
  const char = 'あ';
  return char.repeat(length);
}
```

---

## 5. 要件定義との対応関係

### 5.1 参照したEARS要件

| 要件ID | 要件内容 | 対応テストケース |
|--------|---------|-----------------|
| REQ-801 | システムは、記事の読了時間を自動計算して表示しなければならない（500文字/分、分単位） | TC-RT-001, TC-RT-002, TC-RT-003, TC-FRT-001, TC-FRT-002, TC-FRT-003 |
| EDGE-103 | 読了時間が1分未満の記事は「1分未満」と表示しなければならない | TC-FRT-201, TC-FRT-202 |

### 5.2 参照した受け入れ基準

| テストケースID | 内容 | 対応テストケース |
|---------------|------|-----------------|
| TC-801-01 | 標準的な長さの記事（1500文字）→「約3分で読めます」 | TC-RT-001, TC-FRT-001 |
| TC-801-B01 | 1分未満の記事（200文字）→「1分未満で読めます」 | TC-RT-205, TC-FRT-201 |
| TC-801-B02 | 非常に長い記事（5000文字）→「約10分で読めます」 | TC-RT-002, TC-FRT-003 |

### 5.3 参照した設計文書

| 文書 | 該当セクション | 参照内容 |
|------|--------------|----------|
| note.md | セクション2.1「境界値テスト」 | 499/500/501文字の境界値テストパターン |
| note.md | セクション5.1「空文字列・短い記事の処理」 | 空文字列の処理方針 |
| reading-time-requirements.md | セクション6「実装詳細仕様」 | 計算ロジック、関数シグネチャ |
| test-patterns.md | セクション1.1「日付フォーマット関数」 | テストコード記述パターン |

---

## 6. テストケースサマリー

### 6.1 テストケース数

| カテゴリ | 関数 | 正常系 | 異常系 | 境界値 | 合計 |
|---------|------|--------|--------|--------|------|
| calculateReadingTime() | 計算関数 | 3 | 1 | 5 | 9 |
| formatReadingTime() | 表示関数 | 3 | 0 | 3 | 6 |
| **合計** | - | **6** | **1** | **8** | **15** |

### 6.2 信頼性レベル分布

| レベル | 件数 | 割合 | 説明 |
|--------|------|------|------|
| 🔵 青信号 | 11 | 73% | requirements.md・acceptance-criteria.md・note.mdから確実に導出 |
| 🟡 黄信号 | 4 | 27% | note.md・防御的プログラミングから妥当な推測 |
| 🔴 赤信号 | 0 | 0% | 推測による設計なし |

---

## 7. 品質判定結果

### 7.1 品質基準チェック

| 基準 | 状態 | 説明 |
|------|------|------|
| テストケース分類 | 正常系・異常系・境界値が網羅されている | 正常系6件、異常系1件、境界値8件 |
| 期待値定義 | 各テストケースの期待値が明確 | すべてのケースで具体的な期待値を定義 |
| 技術選択 | TypeScript + Vitest確定 | プロジェクト標準に準拠 |
| 実装可能性 | 現在の技術スタックで実現可能 | 既存のdate.test.tsパターンを踏襲 |
| 信頼性レベル | 🔵（青信号）が73%で多い | 高品質基準を満たす |

### 7.2 品質評価

**評価: ✅ 高品質**

**評価理由**:
- 正常系・異常系・境界値のすべてのカテゴリを網羅
- 各テストケースに明確な期待値と根拠を記載
- 信頼性レベル🔵が73%と高い割合
- 既存のテストパターン（date.test.ts）との一貫性を確保
- 要件定義書・受け入れ基準との対応関係を明記

---

## 8. 次のステップ

テストケース定義書の作成が完了しました。

**次のお勧めステップ**: `/tsumiki:tdd-red blog-article-management TASK-0007` でRedフェーズ（失敗テスト作成）を開始します。

---

**最終更新日**: 2026-01-01
**作成者**: Claude Opus 4.5 (TDD開発エージェント)
