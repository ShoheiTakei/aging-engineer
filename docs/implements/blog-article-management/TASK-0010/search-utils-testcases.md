# TASK-0010: 検索インデックス生成ユーティリティ テストケース定義書

**作成日**: 2026-01-01
**タスク**: TASK-0010
**関連要件**: REQ-401, REQ-402

---

## 1. generateSearchIndex() テストケース

### 1.1 正常系テスト

#### TC-SI-001: 1件の記事から検索インデックスを生成

**入力**:
```typescript
const posts = [
  {
    slug: 'first-post',
    data: {
      title: 'Astro入門',
      description: 'Astroの基本を学ぶ',
      pubDate: new Date('2025-01-15'),
      tags: ['Astro', 'TypeScript'],
      draft: false,
    },
    body: '# はじめに\nAstroは高速な静的サイトジェネレーターです。',
  },
];
```

**期待結果**:
```typescript
[
  {
    slug: 'first-post',
    title: 'Astro入門',
    description: 'Astroの基本を学ぶ',
    body: '# はじめに\nAstroは高速な静的サイトジェネレーターです。',
    tags: ['Astro', 'TypeScript'],
    pubDate: '2025-01-15T00:00:00.000Z',
  },
]
```

#### TC-SI-002: 複数記事から検索インデックスを生成

**入力**: 3件の記事配列
**期待結果**: 3件のインデックスエントリ

#### TC-SI-003: 本文が指定文字数で切り詰められる

**入力**: 本文が1000文字の記事、bodyLength: 500
**期待結果**: bodyが500文字以内

### 1.2 境界値テスト

#### TC-SI-004: 空の記事配列

**入力**: `[]`
**期待結果**: `[]`

#### TC-SI-005: 本文が0文字の記事

**入力**: body: ''
**期待結果**: bodyは空文字列

#### TC-SI-006: タグなしの記事

**入力**: tags: []
**期待結果**: tagsは空配列

#### TC-SI-007: 本文がbodyLengthより短い場合

**入力**: 本文が100文字の記事、bodyLength: 500
**期待結果**: bodyは元の100文字のまま

---

## 2. searchArticles() テストケース

### 2.1 正常系テスト

#### TC-SA-001: タイトルに完全一致するクエリ

**入力**:
```typescript
const index = [
  { slug: 'post-1', title: 'Astro入門', description: '...', body: '...', tags: [], pubDate: '...' },
  { slug: 'post-2', title: 'TypeScript入門', description: '...', body: '...', tags: [], pubDate: '...' },
];
const query = 'Astro入門';
```

**期待結果**: post-1が最上位に表示

#### TC-SA-002: タイトルに部分一致するクエリ

**入力**: query: 'Astro'
**期待結果**: タイトルに'Astro'を含む記事が検索される

#### TC-SA-003: 大文字小文字を区別しない検索

**入力**: query: 'astro' (小文字)
**期待結果**: タイトル'Astro入門'が検索される

#### TC-SA-004: タグに一致するクエリ

**入力**: query: 'TypeScript'、タグに'TypeScript'を含む記事
**期待結果**: 該当記事が検索される

#### TC-SA-005: 本文に一致するクエリ

**入力**: query: 'サイトジェネレーター'、本文に含む記事
**期待結果**: 該当記事が検索される

#### TC-SA-006: 複数フィールドにマッチする場合

**入力**: タイトルと本文の両方に'Astro'を含む記事
**期待結果**: スコアがタイトルのみマッチより高い

#### TC-SA-007: 関連度順にソートされる

**入力**:
- 記事A: タイトルに'Astro'
- 記事B: 本文のみに'Astro'

**期待結果**: 記事Aが記事Bより上位

### 2.2 境界値テスト

#### TC-SA-008: 空のクエリ

**入力**: query: ''
**期待結果**: 空の結果配列

#### TC-SA-009: マッチしないクエリ

**入力**: query: '存在しない単語'
**期待結果**: 空の結果配列

#### TC-SA-010: 空のインデックス

**入力**: index: []
**期待結果**: 空の結果配列

#### TC-SA-011: スペースのみのクエリ

**入力**: query: '   '
**期待結果**: 空の結果配列

#### TC-SA-012: 日本語クエリ

**入力**: query: '入門'
**期待結果**: '入門'を含む記事が検索される

---

## 3. スコアリングロジック

### 重み付け

| フィールド | 重み | 説明 |
|-----------|-----|------|
| title | 10 | タイトル一致は最も重要 |
| tags | 8 | タグ一致も重要 |
| description | 5 | 説明文一致 |
| body | 1 | 本文一致は低い重み |

### スコア計算例

```typescript
// タイトルのみマッチ: 10点
// タグのみマッチ: 8点
// タイトル + 本文マッチ: 10 + 1 = 11点
// 全フィールドマッチ: 10 + 8 + 5 + 1 = 24点
```

---

## 4. マッチ情報

### MatchInfo構造

```typescript
interface MatchInfo {
  field: 'title' | 'description' | 'body' | 'tags';
  indices: [number, number][]; // [開始位置, 終了位置]の配列
}
```

### 例

```typescript
// クエリ: 'Astro'
// タイトル: 'Astro入門'
{
  field: 'title',
  indices: [[0, 5]] // 'Astro'の位置
}
```

---

**最終更新日**: 2026-01-01
