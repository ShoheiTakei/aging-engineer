# フロントエンドテスト基盤 設計ヒアリング記録

**作成日**: 2025-12-28
**ヒアリング実施**: step4 既存情報ベースの差分ヒアリング

## ヒアリング目的

Astro.jsブログプロジェクトのフロントエンドテスト基盤を設計するため、テストスコープ、戦略、環境について明確化しました。

## 質問と回答

### Q1: フロントエンドテスト基盤の設計作業規模について教えてください

**質問日時**: 2025-12-28
**カテゴリ**: 設計規模
**背景**: 包括的な設計が必要か、軽量な設計で十分かを確認するため

**回答**: フル設計（推奨）

**信頼性への影響**:
- この回答により、テストアーキテクチャ、テストパターン例、Vitest設定、Playwright設定、CI/CD統合を含む包括的な設計を作成
- 信頼性レベル: 🔵（青信号） - ユーザーの明確な意思決定

---

### Q2: テスト対象として何を含めますか？（複数選択可）

**質問日時**: 2025-12-28
**カテゴリ**: テストスコープ
**背景**: Astro.jsブログプロジェクトで何をテストすべきかを明確化するため

**回答**: Astroコンポーネント, TypeScriptユーティリティ, Content Collections, R2画像統合（全選択）

**信頼性への影響**:
- この回答により、以下の設計項目の信頼性レベルが 🔴 → 🔵 に向上
  - Astroコンポーネントテスト戦略
  - TypeScriptユーティリティ関数テスト戦略
  - Content Collections APIテスト戦略
  - Cloudflare R2統合テスト戦略

---

### Q3: テストカバレッジの目標を教えてください

**質問日時**: 2025-12-28
**カテゴリ**: テスト戦略
**背景**: 品質基準としてのカバレッジ目標を設定するため

**回答**: 未定

**信頼性への影響**:
- tech-stack.mdの品質基準「テストカバレッジ: 80%以上」を参照し、これを推奨値として設計に反映
- 信頼性レベル: 🟡（黄信号） - tech-stack.mdから妥当な推測

---

### Q4: E2Eテスト（Playwright）はどうしますか？

**質問日時**: 2025-12-28
**カテゴリ**: テスト戦略
**背景**: E2Eテストを単体テストと統合するか、別設計にするかを確認するため

**回答**: 今回に含める

**信頼性への影響**:
- この回答により、Playwright設定とE2Eテストパターンを設計に追加
- 単体テストとE2Eテストの統合設計を作成
- 信頼性レベル: 🔵（青信号） - ユーザーの明確な意思決定

---

### Q5: Cloudflare R2や外部サービスのモック方針を教えてください

**質問日時**: 2025-12-28
**カテゴリ**: テスト環境
**背景**: 外部サービス依存のモック戦略を明確化するため

**回答**: 未定

**信頼性への影響**:
- ベストプラクティスとして「完全モック」を推奨
- 単体テストでは外部サービスを完全にモック化
- E2Eテストでは開発環境のR2バケットを使用（オプション）
- 信頼性レベル: 🟡（黄信号） - 一般的なテストベストプラクティスから推測

---

### Q6: CI/CD統合の優先度を教えてください

**質問日時**: 2025-12-28
**カテゴリ**: CI/CD
**背景**: GitHub Actionsでの自動テスト実行を設計に含めるかを確認するため

**回答**: 未定

**信頼性への影響**:
- Cloudflare Pagesでのデプロイを考慮し、GitHub Actionsでの自動テスト実行を推奨
- プルリクエスト時の自動テスト、カバレッジレポート生成を設計に含める
- 信頼性レベル: 🟡（黄信号） - tech-stack.md・CI/CDベストプラクティスから推測

---

### Q7: Lighthouseスコアの高得点維持を要件に含めますか？

**質問日時**: 2025-12-28
**カテゴリ**: パフォーマンス・品質基準
**背景**: tech-stack.mdに「パフォーマンス: Lighthouse 90+点」と記載があり、テスト基盤でこれを継続的に検証するかを確認

**回答**: はい、Lighthouseスコアの高得点維持を要件とする

**信頼性への影響**:
- Lighthouse CI統合を設計に追加
- パフォーマンス、アクセシビリティ、ベストプラクティス、SEOの4カテゴリを継続的に監視
- GitHub Actionsでのスコア測定と閾値チェックを実装
- 信頼性レベル: 🔵（青信号） - ユーザーの明確な要件、tech-stack.mdの品質基準に準拠

---

### Q8: デザイン要件とコンテンツ表示について

**質問日時**: 2025-12-28
**カテゴリ**: UI/UX要件
**背景**: 追加のデザイン・コンテンツ表示要件を確認

**回答**:
- **デザイン**: ダークテーマがデフォルト、トグルでライトテーマと切り替え可能
- **記事執筆**: Markdownでvimで書く
- **表示形式**: サイト閲覧時はMarkdownのプレビューで表示

**信頼性への影響**:
- ThemeToggleコンポーネントのテストパターンを追加
- ダークモード切り替え機能のE2Eテストを追加
- tech-stack.mdにデザインシステムセクションを追加
- 信頼性レベル: 🔵（青信号） - ユーザーの明確な要件

**テスト設計への影響**:
- コンポーネントテスト: `tests/component/ThemeToggle.test.ts`
- E2Eテスト: `tests/e2e/theme-toggle.spec.ts`
- テスト項目:
  - テーマトグルボタンのレンダリング
  - ダーク/ライトモード切り替え動作
  - localStorage永続化
  - ページリロード時の設定維持
  - フラッシュ防止（初期読み込み時）

---

### Q9: コンポーネント管理について

**質問日時**: 2025-12-28
**カテゴリ**: コンポーネント開発環境
**背景**: コンポーネントの開発・管理手法を確認

**回答**: ComponentはStoryBookで管理

**信頼性への影響**:
- Storybook 8+をコンポーネントカタログツールとして追加
- ビジュアルテスト、ドキュメント化、独立開発環境を提供
- Vitest統合により、ストーリーをテストとしても活用
- 信頼性レベル: 🔵（青信号） - ユーザーの明確な要件

**テスト設計への影響**:
- Storybookストーリーをコンポーネントの仕様書として活用
- `@storybook/experimental-addon-test` でVitestと統合
- ビジュアルリグレッションテスト（将来的に追加可能）
- アクセシビリティテスト（`@storybook/addon-a11y`）
- コンポーネントテストとStorybookストーリーの役割分担:
  - **Storybookストーリー**: UI状態の可視化、ビジュアル確認、ドキュメント
  - **Vitestコンポーネントテスト**: ロジックテスト、レンダリング検証、自動テスト

---

## ヒアリング結果サマリー

### 確認できた事項
- フル設計での包括的なテスト基盤設計が必要
- テスト対象: Astroコンポーネント、TypeScriptユーティリティ、Content Collections、R2画像統合の全範囲
- E2Eテストを単体テストと統合した設計が必要
- Lighthouseスコアの高得点維持を要件とする（tech-stack.mdの品質基準に準拠）
- デザイン: ダークモードデフォルト、テーマトグル機能を実装
- コンテンツ執筆: Vimを使用、Markdownプレビュー表示
- コンポーネント管理: Storybookを使用（ビジュアルテスト、ドキュメント化、独立開発環境）

### 設計方針の決定事項
- Vitest 2+を単体テストフレームワークとして使用
- Playwright 1.49+をE2Eテストフレームワークとして使用
- Storybook 8+をコンポーネントカタログとして使用
- Lighthouse CIを使用してパフォーマンス・品質スコアを継続的に監視
- モック戦略: 単体テストでは外部サービスを完全モック化
- カバレッジ目標: 80%以上（tech-stack.mdの品質基準を参照）
- Lighthouseスコア目標: 各カテゴリ90+点（tech-stack.mdの品質基準を参照）
- CI/CD: GitHub Actionsでの自動テスト実行を推奨
- Storybookストーリーとコンポーネントテストの併用:
  - Storybookストーリー: UI状態の可視化、ビジュアル確認、ドキュメント化
  - Vitestコンポーネントテスト: ロジックテスト、レンダリング検証、自動化テスト

### 残課題
- 具体的なモックライブラリの選定（vi.mock vs MSW）
- テストデータ管理方法の詳細化
- E2Eテスト用の開発環境R2バケット設定

### 信頼性レベル分布

**ヒアリング前**:
- 🔵 青信号: 0件
- 🟡 黄信号: 0件
- 🔴 赤信号: 多数（未定義）

**ヒアリング後**:
- 🔵 青信号: 7件（テストスコープ全範囲、E2E統合、作業規模、Lighthouseスコア要件、デザイン要件、Storybook統合）
- 🟡 黄信号: 3件（カバレッジ目標、モック戦略、CI/CD統合）
- 🔴 赤信号: 0件

## 関連文書

- **アーキテクチャ設計**: [architecture.md](architecture.md)
- **データフロー**: [dataflow.md](dataflow.md)
- **テストパターン**: [test-patterns.md](test-patterns.md)
- **Vitest設定**: [vitest.config.example.ts](vitest.config.example.ts)
- **Playwright設定**: [playwright.config.example.ts](playwright.config.example.ts)
- **技術スタック定義**: [tech-stack.md](../../tech-stack.md)
