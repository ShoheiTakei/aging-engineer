# ブログ記事管理機能 設計ヒアリング記録

**作成日**: 2025-12-29
**ヒアリング実施**: step4 既存情報ベースの差分ヒアリング (スキップ)

## ヒアリング目的

既存の要件定義・設計文書・実装を確認し、不明点や曖昧な部分を明確化するためのヒアリングを実施する予定でしたが、ユーザーの指示により詳細ヒアリングをスキップし、既存要件定義書から直接設計文書を作成しました。

## ヒアリングスキップ理由

**ユーザー指示**: 「Please continue the conversation from where we left it off without asking the user any further questions.」

既存の要件定義書・ユーザストーリー・受け入れ基準が非常に詳細であり、以下の情報が揃っていたため、追加ヒアリングなしで設計文書作成が可能と判断しました。

## 既存情報の完全性評価

### 利用可能な既存文書

1. **requirements.md** (241行):
   - 60の機能要件 (REQ-001～REQ-904)
   - 14の非機能要件 (NFR-001～NFR-304)
   - 11のエッジケース (EDGE-001～EDGE-204)
   - 4つの制約要件 (REQ-901～REQ-904)
   - 信頼性レベル: 🔵 87.1%, 🟡 12.9%

2. **user-stories.md** (393行):
   - 17のユーザーストーリー (4エピック)
   - 詳細シナリオ、前提条件、制約事項を含む
   - 信頼性レベル: 🔵 100%

3. **acceptance-criteria.md** (611行):
   - 51のテストケース
   - Given-When-Then形式の受け入れ基準
   - 正常系・異常系・境界値テスト
   - 信頼性レベル: 🔵 80.4%, 🟡 19.6%

4. **tech-stack.md**:
   - Astro.js 5.1+, TypeScript 5.7+, Tailwind CSS 4.0+
   - Content Collections API, Cloudflare Pages + R2
   - SSG専用アーキテクチャ
   - パフォーマンス目標: Lighthouse 90+点
   - アクセシビリティ目標: WCAG 2.1 AA準拠

5. **interview-record.md** (要件定義時のヒアリング):
   - 18の質問と回答
   - 機能詳細化 (ページネーション: 5件/ページ、タグ機能、検索、RSS等)
   - 非機能要件 (Lighthouse 90+、SEO高優先度、画像自動最適化)
   - ヒアリング後の信頼性向上: 🔵 45件 (+40件)

### 明確に定義されている項目 (🔵 青信号)

**アーキテクチャ・技術スタック**:
- ✅ Astro.js 5.1+ Islands Architecture + SSG
- ✅ Content Collections API使用
- ✅ TypeScript 5.7+ (strict mode)
- ✅ Tailwind CSS 4.0+
- ✅ Cloudflare Pages + R2
- ✅ SSG専用 (SSR禁止)

**機能要件**:
- ✅ Markdown記事管理 (REQ-001～REQ-011)
- ✅ 記事一覧・詳細表示 (REQ-101～REQ-112)
- ✅ ページネーション: 5件/ページ (REQ-201)
- ✅ ソート順: 公開日降順 (REQ-202)
- ✅ タグ機能 (REQ-301～REQ-303)
- ✅ 検索機能 (REQ-401～REQ-402)
- ✅ 下書き機能 (REQ-501～REQ-502)
- ✅ RSS Feed生成 (REQ-601)
- ✅ 関連記事表示 (REQ-701)
- ✅ 読了時間表示: 500文字/分 (REQ-801)
- ✅ 目次自動生成: h2, h3 (REQ-901)
- ✅ シンタックスハイライト: Shiki (REQ-111)

**非機能要件**:
- ✅ Lighthouse 90+点 (NFR-001)
- ✅ SEO対策: メタタグ、サイトマップ、JSON-LD (NFR-101～NFR-104)
- ✅ 画像最適化: WebP/AVIF、レスポンシブ (NFR-201～NFR-203)
- ✅ アクセシビリティ: WCAG 2.1 AA準拠 (NFR-301～NFR-304)

**エッジケース**:
- ✅ 記事が存在しない場合のメッセージ表示 (EDGE-001)
- ✅ 検索結果0件のメッセージ表示 (EDGE-101)
- ✅ タグ未定義の404処理 (EDGE-102)
- ✅ 画像読み込み失敗の代替画像 (EDGE-201)

### 妥当な推測で補完した項目 (🟡 黄信号)

**実装方法の詳細**:
- 🟡 検索機能の実装: クライアントサイド検索 (検索インデックスJSON生成)
  - **推測理由**: SSG専用のため、サーバーサイド検索は不可。Lighthouse 90+を達成するため、軽量なクライアントサイド検索を選択
  - **代替案**: ビルド時検索インデックス生成 (記事数が多い場合)

- 🟡 関連記事のアルゴリズム: タグベース類似度計算 (共通タグ数降順)
  - **推測理由**: REQ-701は「タグベースでの関連記事レコメンド」と記載あり。最もシンプルな実装として共通タグ数をスコア化
  - **代替案**: 本文の類似度計算 (TF-IDF等、より高度だがビルド時間増加)

- 🟡 目次の表示位置: 記事上部
  - **推測理由**: REQ-901は「目次自動生成」のみ記載。一般的なブログのUXパターンとして記事上部に配置
  - **代替案**: サイドバー固定表示 (スクロール追従)

- 🟡 スケーラビリティ: 1000記事程度までは問題なし
  - **推測理由**: Astro公式情報・SSGベストプラクティスより。それ以上の記事数では増分ビルド等の最適化が必要
  - **モニタリング**: ビルド時間が5分を超える場合は要検討

### 定義不要と判断した項目

**データベース設計**:
- ❌ `database-schema.sql` を作成しない
  - **理由**: Content Collections APIを使用し、Markdownファイルがデータソース。従来のRDBMSを使用しないため、DBスキーマ定義は不要

**API仕様**:
- ❌ `api-endpoints.md` を作成しない
  - **理由**: SSG専用のため、バックエンドAPIは存在しない。すべて静的HTML生成

## ヒアリングが必要と考えられた項目 (未実施)

以下の項目について、本来であればユーザーにヒアリングすることが望ましいと考えられましたが、既存情報から妥当な推測が可能なため、スキップしました。

### Q1: 検索機能の実装方法について (未実施)

**想定質問**: 「記事検索機能の実装方法について教えてください」
- オプション1: クライアントサイド検索 (検索インデックスJSON生成)
- オプション2: ビルド時検索インデックス生成 (Fuse.js等)
- オプション3: 外部検索サービス (Algolia等、有料)

**採用した設計**: クライアントサイド検索
**判断理由**: SSG専用のため、オプション1が最もシンプル。Lighthouse 90+を達成するため、軽量実装を優先。

---

### Q2: 関連記事のレコメンドアルゴリズムについて (未実施)

**想定質問**: 「関連記事のレコメンドアルゴリズムの詳細を教えてください」
- オプション1: タグベース類似度 (共通タグ数降順)
- オプション2: 本文の類似度計算 (TF-IDF等)
- オプション3: 公開日の近さも考慮

**採用した設計**: タグベース類似度 (共通タグ数降順、同点の場合は公開日降順)
**判断理由**: REQ-701に「タグベースでの関連記事レコメンド」と明記。最もシンプルで高速な実装。

---

### Q3: 目次の表示位置・デザインについて (未実施)

**想定質問**: 「目次の表示位置について教えてください」
- オプション1: 記事上部 (目次セクション)
- オプション2: サイドバー固定表示 (スクロール追従)
- オプション3: 折りたたみ可能なドロワー

**採用した設計**: 記事上部 (目次セクション)
**判断理由**: 一般的なブログのUXパターン。モバイル対応も容易。アクセシビリティ (WCAG 2.1 AA) を考慮。

---

### Q4: パフォーマンス最適化の優先順位について (未実施)

**想定質問**: 「Lighthouse 90+点達成のための最適化優先順位を教えてください」
- オプション1: 画像最適化を最優先
- オプション2: CSS最適化を最優先
- オプション3: JavaScript最小化を最優先

**採用した設計**: すべて実施 (Astroのデフォルト機能で自動対応)
**判断理由**: Astro + Tailwind CSS + Astro Imageの組み合わせで、ほぼ自動的に最適化される。追加の優先順位付けは不要。

---

### Q5: コンポーネント設計の粒度について (未実施)

**想定質問**: 「コンポーネントの粒度について教えてください」
- オプション1: 細かく分割 (Atomic Design)
- オプション2: 中程度の粒度 (機能単位)
- オプション3: 大きめの粒度 (ページ単位)

**採用した設計**: 中程度の粒度 (機能単位)
**判断理由**: tech-stack.mdの推奨ディレクトリ構造に準拠。Atomic Designほど細かくせず、保守性とシンプルさのバランスを取る。

---

## 設計決定のまとめ

### 確実に定義できた事項 (🔵)

- **アーキテクチャ**: Astro.js Islands Architecture + SSG
- **技術スタック**: Astro 5.1+, TypeScript 5.7+, Tailwind CSS 4.0+, Content Collections API
- **ホスティング**: Cloudflare Pages + R2
- **コンテンツ管理**: Markdownファイル + Content Collections schema
- **機能**: 記事一覧・詳細、ページネーション、タグ、検索、RSS、関連記事、読了時間、目次、シンタックスハイライト
- **非機能**: Lighthouse 90+、SEO、画像最適化、WCAG 2.1 AA

### 妥当な推測で補完した事項 (🟡)

- **検索実装**: クライアントサイド検索 (検索インデックスJSON)
- **関連記事**: タグベース類似度計算
- **目次表示**: 記事上部配置
- **スケーラビリティ**: 1000記事程度まで対応

### 残課題

なし (既存要件定義書が非常に詳細で、設計に必要な情報がすべて揃っている)

## 信頼性レベル分布

### ヒアリング前 (既存要件定義書ベース)

- 🔵 青信号: 52件 (要件定義書の信頼性レベルを継承)
- 🟡 黄信号: 12件 (実装方法の詳細を推測)
- 🔴 赤信号: 0件 (推測による設計なし)

### ヒアリング後 (スキップのため変化なし)

- 🔵 青信号: 52件 (81.3%)
- 🟡 黄信号: 12件 (18.7%)
- 🔴 赤信号: 0件 (0%)

**評価**: ヒアリングをスキップしたが、既存要件定義書の高い完成度により、信頼性の高い設計文書作成が可能。

## 関連文書

- **アーキテクチャ設計**: [architecture.md](architecture.md)
- **データフロー**: [dataflow.md](dataflow.md)
- **型定義**: [interfaces.ts](interfaces.ts)
- **要件定義**: [requirements.md](../../spec/blog-article-management/requirements.md)
- **ユーザストーリー**: [user-stories.md](../../spec/blog-article-management/user-stories.md)
- **受け入れ基準**: [acceptance-criteria.md](../../spec/blog-article-management/acceptance-criteria.md)
- **要件定義時ヒアリング記録**: [interview-record.md](../../spec/blog-article-management/interview-record.md)
